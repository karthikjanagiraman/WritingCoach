<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Practice Phase â€” Chat with Inline Writing Prompts</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Literata:ital,wght@0,400;0,500;0,600;1,400&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --coral: #FF6B6B;
    --coral-dark: #e85d5d;
    --coral-light: #ff8a8a;
    --teal: #4ECDC4;
    --teal-dark: #3dbdb5;
    --yellow: #FFE66D;
    --yellow-light: rgba(255, 230, 109, 0.10);
    --yellow-lighter: rgba(255, 230, 109, 0.05);
    --bg: #FFF9F0;
    --text: #2D3436;
    --text-muted: #636e72;
    --text-light: #b2bec3;
    --white: #FFFFFF;
    --border: #e0dcd5;
    --green: #00b894;
    --green-light: #e6f9f3;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 24px rgba(0,0,0,0.10);
    --radius-sm: 8px;
    --radius-md: 16px;
    --radius-lg: 24px;
    --max-width: 640px;
  }

  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* â”€â”€ Header (sticky) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    width: 100%;
    background: var(--white);
    border-bottom: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
  }

  .header-inner {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 12px 16px;
  }

  .header-top {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
  }

  .back-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: var(--bg);
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
  }

  .back-btn:hover { background: #f0ebe3; }

  .back-btn svg {
    width: 20px;
    height: 20px;
    color: var(--text);
  }

  .header-title {
    flex: 1;
    min-width: 0;
  }

  .header-title h1 {
    font-size: 1.05rem;
    font-weight: 800;
    color: var(--text);
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .header-title .unit-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Phase dots */
  .phase-dots {
    display: flex;
    align-items: center;
    gap: 6px;
    justify-content: center;
  }

  .phase-dot {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .phase-dot .dot {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    color: var(--white);
    font-weight: 800;
  }

  .phase-dot.completed .dot { background: var(--teal); }
  .phase-dot.completed .phase-label { color: var(--teal-dark); }

  .phase-dot.active .dot {
    background: var(--coral);
    box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.25);
  }
  .phase-dot.active .phase-label { color: var(--coral); }

  .phase-dot.future .dot {
    background: var(--text-light);
  }
  .phase-dot.future .phase-label { color: var(--text-light); }

  .phase-connector {
    width: 20px;
    height: 2px;
    background: var(--border);
    border-radius: 1px;
  }

  .phase-connector.completed-connector {
    background: var(--teal);
  }

  /* â”€â”€ Chat Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .chat-area {
    flex: 1;
    width: 100%;
    max-width: var(--max-width);
    padding: 16px 16px 80px 16px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  /* Message group spacing */
  .msg-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 8px;
  }

  /* â”€â”€ Coach Bubble â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .coach-row {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    max-width: 85%;
    align-self: flex-start;
  }

  .coach-avatar {
    width: 34px;
    height: 34px;
    border-radius: 50%;
    background: var(--yellow);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
    box-shadow: var(--shadow-sm);
  }

  .coach-bubble {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 4px var(--radius-md) var(--radius-md) var(--radius-md);
    padding: 12px 16px;
    font-size: 0.95rem;
    line-height: 1.55;
    box-shadow: var(--shadow-sm);
    color: var(--text);
  }

  .coach-name {
    font-size: 0.72rem;
    font-weight: 700;
    color: var(--teal-dark);
    margin-bottom: 3px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  /* â”€â”€ Student Bubble â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .student-row {
    display: flex;
    justify-content: flex-end;
    max-width: 80%;
    align-self: flex-end;
  }

  .student-bubble {
    background: var(--coral);
    color: var(--white);
    border-radius: var(--radius-md) 4px var(--radius-md) var(--radius-md);
    padding: 12px 16px;
    font-size: 0.95rem;
    line-height: 1.5;
    box-shadow: var(--shadow-sm);
  }

  /* â”€â”€ Writing Prompt Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .writing-card {
    width: 100%;
    border-radius: var(--radius-md);
    padding: 20px;
    margin: 8px 0;
    transition: all 0.4s ease;
    position: relative;
  }

  /* Active State */
  .writing-card.active {
    background: linear-gradient(135deg, var(--yellow-light), var(--yellow-lighter));
    border: 2px dashed var(--yellow);
    animation: pulse-border 2.5s ease-in-out infinite;
  }

  @keyframes pulse-border {
    0%, 100% { border-color: var(--yellow); box-shadow: 0 0 0 0 rgba(255, 230, 109, 0); }
    50% { border-color: #f0d84e; box-shadow: 0 0 12px 2px rgba(255, 230, 109, 0.20); }
  }

  /* Completed State */
  .writing-card.completed {
    background: var(--green-light);
    border: 2px solid var(--green);
  }

  .writing-card.completed .writing-card-label { color: var(--green); }

  /* Locked State */
  .writing-card.locked {
    background: #f5f3ef;
    border: 2px dashed #d5d0c8;
    opacity: 0.7;
  }

  .writing-card-label {
    font-size: 0.82rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #c5a31d;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .writing-card.completed .writing-card-label::after {
    content: '  Completed';
    font-size: 0.72rem;
    background: var(--green);
    color: var(--white);
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: 6px;
    letter-spacing: 0;
    text-transform: none;
    font-weight: 700;
  }

  .writing-card-prompt {
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text);
    line-height: 1.5;
    margin-bottom: 14px;
  }

  /* Lined paper textarea */
  .writing-textarea {
    width: 100%;
    min-height: 100px;
    padding: 12px 14px;
    border-radius: var(--radius-sm);
    border: 1.5px solid #e0dcd5;
    background-color: var(--white);
    background-image: repeating-linear-gradient(
      to bottom,
      transparent,
      transparent 29px,
      #e8e4dd 29px,
      #e8e4dd 30px
    );
    background-position: 0 12px;
    font-family: 'Literata', serif;
    font-size: 0.95rem;
    line-height: 30px;
    color: var(--text);
    resize: vertical;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .writing-textarea::placeholder {
    color: var(--text-light);
    font-style: italic;
    font-family: 'Literata', serif;
  }

  .writing-textarea:focus {
    border-color: var(--yellow);
    box-shadow: 0 0 0 3px rgba(255, 230, 109, 0.25);
  }

  .writing-card.completed .writing-textarea {
    background-color: #f0faf5;
    border-color: var(--green);
    color: var(--text);
    cursor: default;
  }

  .writing-card-actions {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-top: 12px;
    gap: 12px;
  }

  .char-count {
    font-size: 0.75rem;
    color: var(--text-muted);
    font-weight: 600;
  }

  .done-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 28px;
    border: none;
    border-radius: 100px;
    background: var(--coral);
    color: var(--white);
    font-family: 'Nunito', sans-serif;
    font-size: 0.92rem;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
    box-shadow: var(--shadow-sm);
  }

  .done-btn:hover {
    background: var(--coral-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
  }

  .done-btn:active { transform: translateY(0); }

  .done-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .completed-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--green);
  }

  .completed-badge svg {
    width: 18px;
    height: 18px;
  }

  /* Quick answer card */
  .writing-card.quick-answer {
    padding: 14px 18px;
  }

  .writing-card.quick-answer .writing-card-label {
    font-size: 0.72rem;
    margin-bottom: 4px;
  }

  .quick-answer-text {
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--text);
    font-weight: 600;
  }

  .quick-answer-input {
    width: 100%;
    height: 42px;
    padding: 0 14px;
    border-radius: var(--radius-sm);
    border: 1.5px solid #e0dcd5;
    background-color: var(--white);
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    color: var(--text);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .quick-answer-input::placeholder {
    color: var(--text-light);
  }

  .quick-answer-input:focus {
    border-color: var(--yellow);
    box-shadow: 0 0 0 3px rgba(255, 230, 109, 0.25);
  }

  .writing-card.completed.quick-answer .writing-card-actions {
    margin-top: 6px;
  }

  /* Locked card content */
  .locked-content {
    text-align: center;
    padding: 12px 0;
    color: var(--text-muted);
    font-weight: 600;
    font-size: 0.9rem;
  }

  .locked-content .lock-icon {
    font-size: 1.3rem;
    display: block;
    margin-bottom: 4px;
  }

  /* â”€â”€ Bottom Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: var(--white);
    border-top: 1px solid var(--border);
    box-shadow: 0 -2px 12px rgba(0,0,0,0.05);
  }

  .bottom-bar-inner {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 12px 16px;
  }

  .progress-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-bottom: 0;
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--text-muted);
  }

  .progress-bar .progress-track {
    flex: 1;
    max-width: 140px;
    height: 6px;
    background: #eae6df;
    border-radius: 3px;
    overflow: hidden;
  }

  .progress-bar .progress-fill {
    height: 100%;
    background: var(--coral);
    border-radius: 3px;
    transition: width 0.6s ease;
  }


  /* â”€â”€ Floating Progress Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .floating-progress {
    position: fixed;
    top: 105px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 90;
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 6px 18px;
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--text-muted);
    box-shadow: var(--shadow-md);
    display: flex;
    align-items: center;
    gap: 6px;
    transition: opacity 0.3s;
  }

  .floating-progress .fp-count {
    color: var(--coral);
    font-weight: 800;
  }

  /* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-in {
    animation: fadeSlideUp 0.4s ease forwards;
  }

  .animate-in-delay {
    opacity: 0;
    animation: fadeSlideUp 0.4s ease forwards;
  }

  /* Typing indicator */
  .typing-indicator {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    max-width: 85%;
    align-self: flex-start;
  }

  .typing-dots {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 4px var(--radius-md) var(--radius-md) var(--radius-md);
    padding: 14px 20px;
    display: flex;
    gap: 5px;
    box-shadow: var(--shadow-sm);
  }

  .typing-dots span {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--text-light);
    animation: typingBounce 1.2s ease-in-out infinite;
  }

  .typing-dots span:nth-child(2) { animation-delay: 0.15s; }
  .typing-dots span:nth-child(3) { animation-delay: 0.3s; }

  @keyframes typingBounce {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-5px); opacity: 1; }
  }

  /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  @media (max-width: 480px) {
    .coach-row { max-width: 92%; }
    .student-row { max-width: 88%; }
    .writing-card { padding: 16px; }
    .phase-dot .phase-label { display: none; }
    .phase-connector { width: 14px; }
  }

  @media (min-width: 768px) {
    .chat-area { padding: 24px 24px 80px 24px; }
  }

  /* Scrollbar styling */
  .chat-area::-webkit-scrollbar { width: 4px; }
  .chat-area::-webkit-scrollbar-track { background: transparent; }
  .chat-area::-webkit-scrollbar-thumb { background: #d5d0c8; border-radius: 2px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
<header class="header">
  <div class="header-inner">
    <div class="header-top">
      <button class="back-btn" aria-label="Go back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
      <div class="header-title">
        <div class="unit-label">Unit 2 &middot; Narrative Writing</div>
        <h1>Story Beginnings</h1>
      </div>
    </div>
    <div class="phase-dots">
      <div class="phase-dot completed">
        <span class="dot">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
        </span>
        <span class="phase-label">Learn</span>
      </div>
      <div class="phase-connector completed-connector"></div>
      <div class="phase-dot active">
        <span class="dot">2</span>
        <span class="phase-label">Practice</span>
      </div>
      <div class="phase-connector"></div>
      <div class="phase-dot future">
        <span class="dot">3</span>
        <span class="phase-label">Write</span>
      </div>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â• FLOATING PROGRESS â•â•â•â•â•â•â• -->
<div class="floating-progress" id="floatingProgress">
  Practice Progress: <span class="fp-count" id="fpCount">1/3</span> writing challenges complete
</div>

<!-- â•â•â•â•â•â•â• CHAT AREA â•â•â•â•â•â•â• -->
<div class="chat-area" id="chatArea">

  <!-- 1. Ollie greeting -->
  <div class="msg-group">
    <div class="coach-row">
      <div class="coach-avatar">ğŸ¦‰</div>
      <div class="coach-bubble">
        <div class="coach-name">Ollie</div>
        Now let's practice what we learned! First, every great story needs a character. Who do you want your story to be about? Tell me about them!
      </div>
    </div>
  </div>

  <!-- 2. Quick Answer Card â€” COMPLETED -->
  <div class="msg-group">
    <div class="writing-card completed quick-answer" id="cardQ1">
      <div class="writing-card-label">ğŸ’¬ Your answer</div>
      <div class="quick-answer-text">A girl named Luna who loves exploring caves</div>
      <div class="writing-card-actions">
        <span class="completed-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="12" cy="12" r="10"/><polyline points="16 9 10.5 14.5 8 12"/></svg>
          Done
        </span>
      </div>
    </div>
  </div>

  <!-- 3. Ollie responds -->
  <div class="msg-group">
    <div class="coach-row">
      <div class="coach-avatar">ğŸ¦‰</div>
      <div class="coach-bubble">
        <div class="coach-name">Ollie</div>
        Luna the cave explorer â€” I love it! ğŸ¦‡ She sounds brave and curious. Now here's your first writing challenge:
      </div>
    </div>
  </div>

  <!-- 4. Writing Prompt Card â€” COMPLETED -->
  <div class="msg-group">
    <div class="writing-card completed" id="card1">
      <div class="writing-card-label">âœï¸ Your turn to write!</div>
      <div class="writing-card-prompt">Write one sentence that introduces Luna to the reader.</div>
      <textarea class="writing-textarea" readonly rows="3">Luna was a small girl with wild red hair who spent every weekend exploring the dark caves near her village.</textarea>
      <div class="writing-card-actions">
        <span class="completed-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="16 9 10.5 14.5 8 12"/></svg>
          Done
        </span>
      </div>
    </div>
  </div>

  <!-- 5. Ollie feedback -->
  <div class="msg-group">
    <div class="coach-row">
      <div class="coach-avatar">ğŸ¦‰</div>
      <div class="coach-bubble">
        <div class="coach-name">Ollie</div>
        That's a great introduction! I can already picture Luna with her wild red hair. ğŸ¨ Now let's think about the setting. Where does your story begin? What can Luna see, hear, and smell?
      </div>
    </div>
  </div>

  <!-- 6. Quick Answer Card â€” COMPLETED -->
  <div class="msg-group">
    <div class="writing-card completed quick-answer" id="cardQ2">
      <div class="writing-card-label">ğŸ’¬ Your answer</div>
      <div class="quick-answer-text">It starts at the entrance of a new cave she just discovered</div>
      <div class="writing-card-actions">
        <span class="completed-badge">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="12" cy="12" r="10"/><polyline points="16 9 10.5 14.5 8 12"/></svg>
          Done
        </span>
      </div>
    </div>
  </div>

  <!-- 7. Ollie responds -->
  <div class="msg-group">
    <div class="coach-row">
      <div class="coach-avatar">ğŸ¦‰</div>
      <div class="coach-bubble">
        <div class="coach-name">Ollie</div>
        Ooh, a brand new cave â€” mysterious! ğŸ•¯ï¸ Let's practice describing it:
      </div>
    </div>
  </div>

  <!-- 8. Writing Prompt Card â€” ACTIVE -->
  <div class="msg-group" id="card2Group">
    <div class="writing-card active" id="card2">
      <div class="writing-card-label">âœï¸ Your turn to write!</div>
      <div class="writing-card-prompt">Describe the cave entrance in 1â€“2 sentences. Use at least two senses (sight, sound, smell, touch).</div>
      <textarea class="writing-textarea" id="card2Textarea" rows="4" placeholder="Start writing here..."></textarea>
      <div class="writing-card-actions">
        <span class="char-count" id="card2CharCount">0 characters</span>
        <button class="done-btn" id="card2DoneBtn">Done âœ“</button>
      </div>
    </div>
  </div>

  <!-- 9. Writing Prompt Card â€” LOCKED -->
  <div class="msg-group" id="card3Group">
    <div class="writing-card locked" id="card3">
      <div class="locked-content">
        <span class="lock-icon">ğŸ”’</span>
        One more writing challenge coming up!
      </div>
    </div>
  </div>

  <!-- Dynamic messages go here -->
  <div id="dynamicMessages"></div>

</div>

<!-- â•â•â•â•â•â•â• BOTTOM BAR â•â•â•â•â•â•â• -->
<div class="bottom-bar">
  <div class="bottom-bar-inner">
    <div class="progress-bar">
      <span>âœï¸</span>
      <span id="progressText">1 of 3 writing challenges done</span>
      <div class="progress-track">
        <div class="progress-fill" id="progressFill" style="width: 33.3%"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  'use strict';

  // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let challengesDone = 1;
  const totalChallenges = 3;
  let card2Submitted = false;
  let card3Revealed = false;

  // â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const chatArea = document.getElementById('chatArea');
  const dynamicMessages = document.getElementById('dynamicMessages');
  const card2 = document.getElementById('card2');
  const card2Textarea = document.getElementById('card2Textarea');
  const card2DoneBtn = document.getElementById('card2DoneBtn');
  const card2CharCount = document.getElementById('card2CharCount');
  const card3 = document.getElementById('card3');
  const card3Group = document.getElementById('card3Group');
  const progressText = document.getElementById('progressText');
  const progressFill = document.getElementById('progressFill');
  const fpCount = document.getElementById('fpCount');

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function smoothScrollToBottom() {
    setTimeout(() => {
      chatArea.scrollTo({ top: chatArea.scrollHeight, behavior: 'smooth' });
    }, 80);
  }

  function updateProgress() {
    progressText.textContent = challengesDone + ' of ' + totalChallenges + ' writing challenges done';
    progressFill.style.width = ((challengesDone / totalChallenges) * 100) + '%';
    fpCount.textContent = challengesDone + '/' + totalChallenges;
  }

  function createCoachMessage(text) {
    const group = document.createElement('div');
    group.className = 'msg-group animate-in';
    group.innerHTML =
      '<div class="coach-row">' +
        '<div class="coach-avatar">ğŸ¦‰</div>' +
        '<div class="coach-bubble">' +
          '<div class="coach-name">Ollie</div>' +
          text +
        '</div>' +
      '</div>';
    return group;
  }

  function createStudentMessage(text) {
    const group = document.createElement('div');
    group.className = 'msg-group animate-in';
    group.innerHTML =
      '<div class="student-row">' +
        '<div class="student-bubble">' + escapeHTML(text) + '</div>' +
      '</div>';
    return group;
  }

  function createTypingIndicator() {
    const el = document.createElement('div');
    el.className = 'typing-indicator animate-in';
    el.id = 'typingIndicator';
    el.innerHTML =
      '<div class="coach-avatar">ğŸ¦‰</div>' +
      '<div class="typing-dots"><span></span><span></span><span></span></div>';
    return el;
  }

  function removeTypingIndicator() {
    const el = document.getElementById('typingIndicator');
    if (el) el.remove();
  }

  function escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  // â”€â”€ Character count for card 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  card2Textarea.addEventListener('input', function() {
    const len = card2Textarea.value.length;
    card2CharCount.textContent = len + ' character' + (len !== 1 ? 's' : '');
  });

  // â”€â”€ Card 2 Done button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  card2DoneBtn.addEventListener('click', function() {
    if (card2Submitted) return;

    const text = card2Textarea.value.trim();
    if (!text) {
      card2Textarea.focus();
      card2Textarea.style.borderColor = 'var(--coral)';
      card2Textarea.style.boxShadow = '0 0 0 3px rgba(255,107,107,0.18)';
      setTimeout(() => {
        card2Textarea.style.borderColor = '';
        card2Textarea.style.boxShadow = '';
      }, 1200);
      return;
    }

    card2Submitted = true;

    // Transition card to completed state
    card2.classList.remove('active');
    card2.classList.add('completed');
    card2Textarea.readOnly = true;
    card2.querySelector('.writing-card-actions').innerHTML =
      '<span class="completed-badge">' +
        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="12" cy="12" r="10"/><polyline points="16 9 10.5 14.5 8 12"/></svg>' +
        'Done' +
      '</span>';

    // Update progress
    challengesDone = 2;
    updateProgress();

    smoothScrollToBottom();

    // After 1s, show Ollie feedback
    setTimeout(function() {
      // Show typing indicator first
      dynamicMessages.appendChild(createTypingIndicator());
      smoothScrollToBottom();

      setTimeout(function() {
        removeTypingIndicator();
        const msg = createCoachMessage("Wonderful description! I can feel the cold air from that cave! ğŸ¦‡ You really made me feel like I was standing right there.");
        dynamicMessages.appendChild(msg);
        smoothScrollToBottom();

        // After 1.5s, reveal the third card
        setTimeout(function() {
          // Show typing indicator
          dynamicMessages.appendChild(createTypingIndicator());
          smoothScrollToBottom();

          setTimeout(function() {
            removeTypingIndicator();

            // Add Ollie intro message for card 3
            const introMsg = createCoachMessage("Now for our final challenge â€” let's write an opening line that really grabs the reader:");
            dynamicMessages.appendChild(introMsg);
            smoothScrollToBottom();

            // Transform the locked card into an active card
            setTimeout(function() {
              card3Revealed = true;
              card3.classList.remove('locked');
              card3.classList.add('active');
              card3.innerHTML =
                '<div class="writing-card-label">âœï¸ Your turn to write!</div>' +
                '<div class="writing-card-prompt">Write an opening line that hooks the reader â€” make them curious about what Luna will find!</div>' +
                '<textarea class="writing-textarea" id="card3Textarea" rows="4" placeholder="Start writing here..."></textarea>' +
                '<div class="writing-card-actions">' +
                  '<span class="char-count" id="card3CharCount">0 characters</span>' +
                  '<button class="done-btn" id="card3DoneBtn">Done âœ“</button>' +
                '</div>';

              // Move card3Group into dynamicMessages so it appears in order
              dynamicMessages.appendChild(card3Group);
              smoothScrollToBottom();

              // Attach events to new card 3 elements
              const card3Textarea = document.getElementById('card3Textarea');
              const card3DoneBtn = document.getElementById('card3DoneBtn');
              const card3CharCount = document.getElementById('card3CharCount');

              card3Textarea.addEventListener('input', function() {
                const len = card3Textarea.value.length;
                card3CharCount.textContent = len + ' character' + (len !== 1 ? 's' : '');
              });

              card3DoneBtn.addEventListener('click', function() {
                const t = card3Textarea.value.trim();
                if (!t) {
                  card3Textarea.focus();
                  card3Textarea.style.borderColor = 'var(--coral)';
                  card3Textarea.style.boxShadow = '0 0 0 3px rgba(255,107,107,0.18)';
                  setTimeout(() => {
                    card3Textarea.style.borderColor = '';
                    card3Textarea.style.boxShadow = '';
                  }, 1200);
                  return;
                }

                // Complete card 3
                card3.classList.remove('active');
                card3.classList.add('completed');
                card3Textarea.readOnly = true;
                card3.querySelector('.writing-card-actions').innerHTML =
                  '<span class="completed-badge">' +
                    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><circle cx="12" cy="12" r="10"/><polyline points="16 9 10.5 14.5 8 12"/></svg>' +
                    'Done' +
                  '</span>';

                challengesDone = 3;
                updateProgress();

                smoothScrollToBottom();

                // Final Ollie message
                setTimeout(function() {
                  dynamicMessages.appendChild(createTypingIndicator());
                  smoothScrollToBottom();

                  setTimeout(function() {
                    removeTypingIndicator();
                    const finalMsg = createCoachMessage(
                      "What a fantastic opening line! ğŸŒŸ You've completed all three writing challenges â€” your story is really coming together!<br><br>" +
                      "<strong style=\"color: var(--green);\">All practice challenges complete!</strong> You're ready to move on to the Write phase where you'll put it all together into a full story opening."
                    );
                    dynamicMessages.appendChild(finalMsg);
                    smoothScrollToBottom();

                    // Show completion celebration on floating banner
                    const fp = document.getElementById('floatingProgress');
                    fp.innerHTML = 'ğŸ‰ All writing challenges complete! <span class="fp-count" style="color: var(--green);">3/3</span>';
                  }, 800);
                }, 1000);
              });
            }, 400);
          }, 900);
        }, 1500);
      }, 1000);
    }, 1000);
  });

  // â”€â”€ Initial scroll to bottom â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  setTimeout(function() {
    chatArea.scrollTop = chatArea.scrollHeight;
  }, 100);

  // â”€â”€ Floating progress hide on scroll near top â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const floatingProgress = document.getElementById('floatingProgress');
  let lastScroll = 0;
  chatArea.addEventListener('scroll', function() {
    const st = chatArea.scrollTop;
    if (st < 50) {
      floatingProgress.style.opacity = '0';
    } else {
      floatingProgress.style.opacity = '1';
    }
    lastScroll = st;
  });

})();
</script>

</body>
</html>
