<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Writer's Trial — Adventure Academy</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700;800;900&family=Nunito:wght@500;600;700;800;900&family=Literata:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
  /* ═══════════════════════════════════════════════
     DESIGN TOKENS
  ═══════════════════════════════════════════════ */
  :root {
    --void: #080B16;
    --deep: #0F1328;
    --mid: #1A1E3A;
    --surface: #252A4A;
    --gold: #C8973E;
    --gold-bright: #F0C75E;
    --gold-pale: #FFE8A3;
    --ember: #D4532A;
    --ember-light: #FF7B5C;
    --teal: #3ECFC4;
    --teal-glow: #3ECFC440;
    --parchment: #F2E3C6;
    --parchment-light: #FFF6E3;
    --parchment-dark: #D8C49C;
    --ink: #2C1810;
    --ink-mid: #5D4E37;
    --ink-light: #8B7355;
    --seal-red: #B92D1A;
    --seal-red-light: #E04832;

    --font-display: 'Cinzel', serif;
    --font-body: 'Nunito', sans-serif;
    --font-writing: 'Literata', 'Georgia', serif;

    --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
    --ease-smooth: cubic-bezier(0.25, 0.1, 0.25, 1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  /* ═══════════════════════════════════════════════
     THE VOID — Deep Night Sky
  ═══════════════════════════════════════════════ */
  body {
    font-family: var(--font-body);
    min-height: 100vh;
    overflow-x: hidden;
    background: var(--void);
    color: var(--ink);
    cursor: default;
  }

  .sky {
    position: fixed; inset: 0; z-index: 0;
    background:
      radial-gradient(ellipse at 25% 15%, #1a1540 0%, transparent 50%),
      radial-gradient(ellipse at 75% 80%, #201530 0%, transparent 45%),
      radial-gradient(ellipse at 50% 50%, var(--deep) 0%, var(--void) 100%);
    animation: skyReveal 1.2s var(--ease-smooth) both;
  }
  @keyframes skyReveal { from { opacity: 0; } to { opacity: 1; } }

  /* Nebula wash — warm golden mist */
  .nebula {
    position: absolute; border-radius: 50%; pointer-events: none;
    filter: blur(80px); mix-blend-mode: screen;
  }
  .nebula-1 { width: 600px; height: 400px; background: #C8973E08; top: 5%; left: 15%; }
  .nebula-2 { width: 400px; height: 500px; background: #D4532A06; bottom: 10%; right: 5%; }
  .nebula-3 { width: 500px; height: 300px; background: #F0C75E05; top: 40%; left: 55%; }

  /* Star field */
  .star {
    position: absolute; border-radius: 50%;
    animation: twinkle ease-in-out infinite;
  }
  .star--gold { background: var(--gold-bright); }
  .star--white { background: #E8E4F0; }
  .star--blue { background: #8DA4D4; }
  @keyframes twinkle {
    0%, 100% { opacity: var(--min-o, 0.15); transform: scale(0.8); }
    50% { opacity: var(--max-o, 0.85); transform: scale(1.2); }
  }

  /* Floating dust motes */
  .mote {
    position: absolute; width: 2px; height: 2px; border-radius: 50%;
    background: var(--gold-bright); opacity: 0;
    animation: moteFloat linear infinite;
  }
  @keyframes moteFloat {
    0% { opacity: 0; transform: translateY(0) translateX(0); }
    15% { opacity: 0.4; }
    85% { opacity: 0.3; }
    100% { opacity: 0; transform: translateY(-120px) translateX(var(--mx, 20px)); }
  }

  /* ═══════════════════════════════════════════════
     LAYOUT — Asymmetric Composition
  ═══════════════════════════════════════════════ */
  .stage {
    position: relative; z-index: 1;
    display: flex; max-width: 1100px; margin: 0 auto;
    padding: 32px 24px 80px; gap: 36px;
    min-height: 100vh; align-items: flex-start;
  }

  /* ═══════════════════════════════════════════════
     CONSTELLATION MAP — The Quest Trail
  ═══════════════════════════════════════════════ */
  .constellation {
    width: 190px; flex-shrink: 0; padding-top: 20px;
    opacity: 0; animation: constReveal 0.8s 0.4s var(--ease-smooth) forwards;
  }
  @keyframes constReveal { to { opacity: 1; } }

  .constellation__title {
    font-family: var(--font-display); font-size: 11px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 4px; color: var(--gold);
    text-align: center; margin-bottom: 24px; opacity: 0.6;
  }

  .constellation__map {
    position: relative; display: flex; flex-direction: column; align-items: center;
  }

  /* SVG constellation lines */
  .constellation__lines {
    position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
    width: 80px; pointer-events: none; z-index: 0;
  }
  .line-bg {
    stroke: var(--gold); stroke-width: 1.5; fill: none;
    stroke-dasharray: 4 8; opacity: 0.12;
  }
  .line-glow {
    stroke: var(--gold-bright); stroke-width: 2; fill: none;
    filter: url(#constellationGlow);
    stroke-dasharray: 360; stroke-dashoffset: 360;
    transition: stroke-dashoffset 2s var(--ease-smooth);
    opacity: 0.8;
  }

  /* Star nodes */
  .starnode {
    position: relative; z-index: 2; display: flex; flex-direction: column; align-items: center;
    margin-bottom: 28px;
    transition: all 0.8s var(--ease-bounce);
  }
  .starnode--hidden { opacity: 0; height: 0; margin: 0; overflow: hidden; transform: scale(0.3); }
  .starnode--visible { opacity: 1; height: auto; transform: scale(1); }

  .starnode__tag {
    font-family: var(--font-display); font-size: 7px; font-weight: 800;
    text-transform: uppercase; letter-spacing: 3px;
    color: var(--gold-bright); margin-bottom: 8px;
    text-shadow: 0 0 12px var(--gold);
    animation: tagPulse 2.5s ease-in-out infinite;
  }
  @keyframes tagPulse { 0%,100% { opacity: 0.7; } 50% { opacity: 1; } }

  .starnode__orb {
    width: 110px; height: 110px; border-radius: 28px; position: relative;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.5s var(--ease-smooth);
  }
  .starnode__orb svg { width: 70px; height: 70px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)); }

  /* Active — golden glow, floating */
  .starnode__orb--active {
    background: linear-gradient(150deg, var(--parchment-light), var(--parchment-dark));
    box-shadow:
      0 10px 0 #8B691420,
      0 16px 40px rgba(0,0,0,0.4),
      inset 0 2px 6px rgba(255,255,255,0.5),
      0 0 50px var(--gold)15;
    animation: orbFloat 3.5s ease-in-out infinite;
  }
  @keyframes orbFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }

  /* Complete — teal serenity */
  .starnode__orb--done {
    background: linear-gradient(150deg, #D0F5E8, #9CE8D0);
    box-shadow:
      0 8px 0 #1A8A6820,
      0 12px 30px rgba(0,0,0,0.3),
      inset 0 2px 5px rgba(255,255,255,0.4),
      0 0 40px var(--teal-glow);
  }

  /* Locked — dark void */
  .starnode__orb--locked {
    background: linear-gradient(150deg, var(--surface), var(--mid));
    box-shadow:
      0 8px 0 #0B0E1640,
      0 12px 30px rgba(0,0,0,0.4),
      inset 0 2px 4px rgba(255,255,255,0.03);
    opacity: 0.4;
  }
  .starnode__orb--locked svg { filter: grayscale(1) brightness(0.4); }

  .starnode__check {
    position: absolute; top: -6px; right: -6px;
    width: 30px; height: 30px; border-radius: 50%;
    background: linear-gradient(135deg, var(--teal), #26D0CE);
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 15px; font-weight: 900;
    box-shadow: 0 4px 14px var(--teal-glow);
    animation: checkBurst 0.5s var(--ease-bounce);
  }
  @keyframes checkBurst { from { transform: scale(0) rotate(-45deg); } to { transform: scale(1) rotate(0); } }

  .starnode__name {
    font-family: var(--font-display); font-size: 10px; font-weight: 700;
    color: var(--gold); opacity: 0.7; margin-top: 10px;
    letter-spacing: 1px; text-align: center;
    text-shadow: 0 1px 4px rgba(0,0,0,0.5);
  }
  .starnode--done .starnode__name { color: var(--teal); opacity: 0.8; }
  .starnode--locked .starnode__name { color: #FFFFFF18; }

  /* ═══════════════════════════════════════════════
     THE GRIMOIRE — Parchment Page
  ═══════════════════════════════════════════════ */
  .grimoire {
    flex: 1; min-width: 0; position: relative;
    opacity: 0; transform: translateY(24px) rotate(0.3deg);
    animation: grimoireEnter 0.9s 0.6s var(--ease-smooth) forwards;
  }
  @keyframes grimoireEnter {
    to { opacity: 1; transform: translateY(0) rotate(0.3deg); }
  }

  .grimoire__page {
    position: relative; border-radius: 6px 22px 22px 6px;
    background: linear-gradient(172deg, var(--parchment-light) 0%, var(--parchment) 35%, var(--parchment-dark) 100%);
    box-shadow:
      -4px 0 0 #C0A97A,
      -7px 0 0 #A8916A,
      0 24px 80px rgba(0,0,0,0.5),
      0 4px 8px rgba(0,0,0,0.15),
      inset 0 1px 0 rgba(255,255,255,0.5),
      inset 0 -3px 8px rgba(160,120,60,0.12);
    overflow: hidden;
  }

  /* Paper grain overlay */
  .grimoire__grain {
    position: absolute; inset: 0; z-index: 0; border-radius: inherit;
    opacity: 0.06; pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='g'%3E%3CfeTurbulence baseFrequency='0.7' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23g)'/%3E%3C/svg%3E");
  }

  /* Decorative margin line (like an old book) */
  .grimoire__margin {
    position: absolute; left: 52px; top: 0; bottom: 0; width: 1px;
    background: var(--ember); opacity: 0.08; z-index: 0;
  }

  .grimoire__inner { position: relative; z-index: 1; }

  /* ── Page Header ── */
  .page-head {
    padding: 28px 32px 20px 68px; position: relative;
    border-bottom: 1px solid rgba(139,105,20,0.1);
    opacity: 0; animation: contentFade 0.5s 0.9s var(--ease-smooth) forwards;
  }
  @keyframes contentFade { to { opacity: 1; } }

  .page-head__badge {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 3px 12px; border-radius: 4px;
    background: linear-gradient(135deg, var(--ember)12, var(--gold)08);
    border: 1px solid var(--ember)20;
    font-family: var(--font-display); font-size: 9px; font-weight: 800;
    letter-spacing: 2.5px; text-transform: uppercase; color: var(--ember);
    margin-bottom: 10px;
  }
  .page-head__badge::before {
    content: ''; width: 6px; height: 6px; border-radius: 50%;
    background: var(--ember); opacity: 0.6;
    animation: dotPulse 1.8s ease-in-out infinite;
  }
  @keyframes dotPulse { 0%,100% { opacity: 0.3; transform: scale(0.8); } 50% { opacity: 0.8; transform: scale(1.2); } }

  .page-head__title {
    font-family: var(--font-display); font-size: 26px; font-weight: 800;
    color: var(--ink); letter-spacing: 1px;
    display: flex; align-items: center; gap: 16px;
  }
  .page-head__icon {
    width: 52px; height: 52px; border-radius: 14px; flex-shrink: 0;
    background: linear-gradient(150deg, var(--parchment-light), var(--gold-pale));
    box-shadow: 0 4px 0 #B8941A20, 0 6px 16px rgba(0,0,0,0.08), inset 0 2px 3px rgba(255,255,255,0.5);
    display: flex; align-items: center; justify-content: center;
    animation: iconBob 3s ease-in-out infinite;
  }
  @keyframes iconBob { 0%,100% { transform: translateY(0) rotate(0); } 50% { transform: translateY(-2px) rotate(1.5deg); } }
  .page-head__icon svg { width: 36px; height: 36px; }

  /* ── Ollie's Counsel ── */
  .counsel {
    display: flex; gap: 14px; margin-top: 14px; padding: 12px 16px;
    background: rgba(255,255,255,0.35);
    border-radius: 14px; border: 1px solid rgba(200,151,62,0.12);
    position: relative;
    opacity: 0; animation: contentFade 0.5s 1.05s var(--ease-smooth) forwards;
  }
  .counsel::after {
    content: ''; position: absolute; left: 26px; top: -7px;
    width: 14px; height: 14px; background: rgba(255,255,255,0.35);
    border-left: 1px solid rgba(200,151,62,0.12);
    border-top: 1px solid rgba(200,151,62,0.12);
    transform: rotate(45deg);
  }
  .counsel__avatar {
    width: 48px; height: 48px; flex-shrink: 0;
    background: linear-gradient(150deg, var(--gold), #8B6914);
    border-radius: 14px;
    box-shadow: 0 3px 0 #5D4037 30, 0 5px 12px rgba(0,0,0,0.15), inset 0 2px 3px rgba(255,255,255,0.2);
    display: flex; align-items: center; justify-content: center;
  }
  .counsel__avatar svg { width: 38px; height: 38px; }
  .counsel__text {
    flex: 1; font-size: 13px; font-weight: 600; color: var(--ink-mid);
    line-height: 1.7; font-style: italic;
  }

  /* ── The Sealed Challenge ── */
  .challenge {
    margin: 20px 32px 0 68px; padding: 16px 20px 16px 28px;
    background: linear-gradient(140deg, #FFF0D0, #FFEABC);
    border-radius: 12px; position: relative;
    box-shadow: inset 0 1px 2px rgba(255,255,255,0.5), 0 3px 10px rgba(0,0,0,0.05);
    border: 1px solid rgba(200,151,62,0.15);
    opacity: 0; animation: contentFade 0.5s 1.15s var(--ease-smooth) forwards;
  }
  /* Wax seal */
  .challenge__seal {
    position: absolute; left: -18px; top: 8px;
    width: 40px; height: 40px; border-radius: 50%;
    background: radial-gradient(circle at 35% 30%, var(--seal-red-light), var(--seal-red));
    box-shadow:
      0 4px 12px rgba(185,45,26,0.45),
      inset 0 3px 4px rgba(255,180,160,0.25),
      inset 0 -3px 6px rgba(0,0,0,0.25),
      0 0 0 2.5px #7A1A0E60;
    display: flex; align-items: center; justify-content: center;
    z-index: 2;
  }
  .challenge__seal-stamp {
    font-family: var(--font-display); font-size: 14px; font-weight: 900;
    color: var(--gold-pale); opacity: 0.7;
    text-shadow: 0 1px 2px rgba(0,0,0,0.4);
  }
  /* Inner ring on seal */
  .challenge__seal::after {
    content: ''; position: absolute; inset: 4px; border-radius: 50%;
    border: 1px solid rgba(255,200,120,0.15);
  }

  .challenge__label {
    font-family: var(--font-display); font-size: 8px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 3px;
    color: var(--ink-light); opacity: 0.5; margin-bottom: 6px;
  }
  .challenge__prompt {
    font-size: 14.5px; font-weight: 700; color: var(--ink); line-height: 1.7;
  }

  /* ── The Writing Surface ── */
  .quill-pad {
    margin: 20px 32px 0 68px; position: relative;
    opacity: 0; animation: contentFade 0.5s 1.25s var(--ease-smooth) forwards;
  }
  .quill-pad__area {
    width: 100%; min-height: 210px; border: none; border-radius: 10px;
    padding: 22px 24px; resize: vertical; outline: none;
    font-family: var(--font-writing); font-size: 15px;
    color: var(--ink); line-height: 2;
    background:
      repeating-linear-gradient(transparent, transparent 29px, rgba(139,105,20,0.06) 29px, rgba(139,105,20,0.06) 30px),
      linear-gradient(180deg, #FFF5E0, #EDE0C4);
    box-shadow:
      inset 0 3px 12px rgba(139,105,20,0.1),
      inset 0 0 0 1.5px rgba(200,151,62,0.12),
      0 2px 8px rgba(0,0,0,0.03);
    transition: box-shadow 0.4s var(--ease-smooth);
  }
  .quill-pad__area:focus {
    box-shadow:
      inset 0 3px 12px rgba(139,105,20,0.08),
      inset 0 0 0 2px var(--gold)25,
      0 0 24px var(--gold)08,
      0 2px 8px rgba(0,0,0,0.03);
  }
  .quill-pad__area::placeholder { color: rgba(139,105,20,0.2); font-style: italic; }

  /* Ink particles */
  .quill-pad__sparks { position: absolute; inset: 0; pointer-events: none; overflow: hidden; border-radius: 10px; }
  .ink-mote {
    position: absolute; border-radius: 50%; pointer-events: none;
    animation: inkRise 1s ease-out forwards;
  }
  @keyframes inkRise {
    0% { opacity: 0.9; transform: translate(0,0) scale(1); }
    100% { opacity: 0; transform: translate(var(--ix), var(--iy)) scale(0.2); }
  }

  /* ── Ember Meter + Submit ── */
  .footer-bar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 32px 26px 68px; gap: 20px;
    opacity: 0; animation: contentFade 0.5s 1.35s var(--ease-smooth) forwards;
  }
  .ember-meter { flex: 1; max-width: 260px; display: flex; align-items: center; gap: 14px; }
  .ember-tube {
    flex: 1; height: 16px; border-radius: 8px; position: relative; overflow: hidden;
    background: rgba(200,151,62,0.08);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.06), 0 1px 2px rgba(255,255,255,0.2);
    border: 1px solid rgba(200,151,62,0.12);
  }
  .ember-fill {
    position: absolute; left: 0; top: 0; bottom: 0; width: 0%;
    border-radius: 7px;
    background: linear-gradient(90deg, var(--ember), var(--ember-light), var(--gold-bright), var(--gold-pale));
    box-shadow: 0 0 10px rgba(212,83,42,0.25);
    transition: width 0.6s var(--ease-smooth);
    overflow: hidden;
  }
  .ember-fill::after {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(90deg, transparent 30%, rgba(255,255,255,0.35) 50%, transparent 70%);
    animation: shimmer 2.5s ease-in-out infinite;
  }
  @keyframes shimmer { 0%,100% { transform: translateX(-120%); } 50% { transform: translateX(120%); } }
  .ember-fill--full { box-shadow: 0 0 24px var(--gold-bright)40, 0 0 48px var(--ember)15; }

  .ember-count {
    font-family: var(--font-display); font-size: 11px; font-weight: 700;
    color: var(--ink-light); opacity: 0.4; white-space: nowrap; letter-spacing: 0.5px;
  }
  .ember-count--ready { color: var(--ember); opacity: 0.9; text-shadow: 0 0 8px rgba(212,83,42,0.2); }

  /* The Button */
  .btn-submit {
    border: none; padding: 14px 34px; border-radius: 10px;
    font-family: var(--font-display); font-size: 13px; font-weight: 800;
    text-transform: uppercase; letter-spacing: 2px;
    cursor: not-allowed; position: relative; overflow: hidden;
    transition: all 0.5s var(--ease-smooth);
    color: var(--ink-light); opacity: 0.3;
    background: linear-gradient(150deg, rgba(200,151,62,0.15), rgba(200,151,62,0.08));
    box-shadow: 0 3px 0 rgba(200,151,62,0.08);
  }
  .btn-submit--ready {
    cursor: pointer; opacity: 1;
    color: #4A2800;
    background: linear-gradient(150deg, var(--gold-bright), var(--gold), #D4A030);
    box-shadow:
      0 6px 0 #8B691440,
      0 12px 36px rgba(200,151,62,0.35),
      inset 0 2px 4px rgba(255,255,255,0.4);
    animation: btnPulse 2.5s ease-in-out infinite;
  }
  @keyframes btnPulse {
    0%,100% { box-shadow: 0 6px 0 #8B691440, 0 12px 36px rgba(200,151,62,0.35), inset 0 2px 4px rgba(255,255,255,0.4); }
    50% { box-shadow: 0 6px 0 #8B691440, 0 12px 48px rgba(200,151,62,0.5), inset 0 2px 4px rgba(255,255,255,0.4), 0 0 24px var(--gold-bright)20; }
  }
  .btn-submit--ready:hover { transform: translateY(-3px); }
  .btn-submit--ready:active { transform: translateY(2px); box-shadow: 0 2px 0 #8B691440; }
  .btn-submit--ready::after {
    content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
    animation: sweep 4s ease-in-out infinite;
  }
  @keyframes sweep { 0%,80%,100% { left: -100%; } 40% { left: 150%; } }

  /* ═══════════════════════════════════════════════
     CELEBRATION OVERLAY
  ═══════════════════════════════════════════════ */
  .celebration {
    position: fixed; inset: 0; z-index: 200;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.6s;
  }
  .celebration--show { opacity: 1; pointer-events: auto; }
  .celebration__bg {
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 40%, #1a1e3aee, var(--void)f5);
  }
  .celebration__body { position: relative; z-index: 2; text-align: center; }
  .celebration__icon {
    width: 130px; height: 130px; margin: 0 auto 20px; border-radius: 30px;
    background: linear-gradient(150deg, var(--parchment-light), var(--parchment-dark));
    box-shadow: 0 10px 0 #8B691420, 0 20px 50px rgba(0,0,0,0.4), 0 0 80px var(--gold)12;
    display: flex; align-items: center; justify-content: center;
    animation: celebPop 0.6s var(--ease-bounce);
  }
  .celebration__icon svg { width: 80px; height: 80px; }
  @keyframes celebPop { 0% { transform: scale(0) rotate(-15deg); } 70% { transform: scale(1.1) rotate(3deg); } 100% { transform: scale(1) rotate(0); } }
  .celebration__title {
    font-family: var(--font-display); font-size: 26px; font-weight: 800;
    color: var(--gold-bright); letter-spacing: 1px;
    text-shadow: 0 2px 12px rgba(0,0,0,0.4);
    animation: fadeUp 0.4s 0.2s both;
  }
  .celebration__sub {
    font-size: 14px; font-weight: 600; color: var(--gold); opacity: 0.6;
    max-width: 320px; line-height: 1.6; margin: 8px auto 0;
    animation: fadeUp 0.4s 0.35s both;
  }
  .confetti-bit {
    position: absolute; z-index: 1; animation: confettiDrop linear forwards;
  }
  @keyframes confettiDrop {
    0% { transform: translateY(0) rotate(0) scale(1); opacity: 1; }
    85% { opacity: 0.9; }
    100% { transform: translateY(var(--fall, 500px)) rotate(var(--spin, 800deg)) scale(0.3); opacity: 0; }
  }

  /* ═══════════════════════════════════════════════
     FINALE
  ═══════════════════════════════════════════════ */
  .finale {
    position: fixed; inset: 0; z-index: 200;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 40px; opacity: 0; pointer-events: none; transition: opacity 1s;
    overflow: hidden;
  }
  .finale--show { opacity: 1; pointer-events: auto; }
  .finale__bg {
    position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 35%, #1a1e3a, var(--deep), var(--void));
  }
  .finale__stars { position: absolute; inset: 0; pointer-events: none; }

  .finale__body { position: relative; z-index: 2; text-align: center; }
  .finale__owl {
    margin-bottom: 12px;
    animation: owlLand 0.9s var(--ease-bounce);
  }
  .finale__owl svg { width: 88px; height: 88px; filter: drop-shadow(0 6px 16px rgba(0,0,0,0.4)); }
  @keyframes owlLand { 0% { transform: scale(0) translateY(50px); opacity: 0; } 60% { transform: scale(1.15) translateY(-8px); } 100% { transform: scale(1) translateY(0); opacity: 1; } }

  .finale__heading {
    font-family: var(--font-display); font-size: 28px; font-weight: 800;
    color: var(--gold-bright); letter-spacing: 1px;
    text-shadow: 0 3px 14px rgba(0,0,0,0.4);
    animation: fadeUp 0.5s 0.25s both;
  }
  .finale__text {
    font-size: 15px; font-weight: 600; color: var(--gold); opacity: 0.55;
    max-width: 400px; line-height: 1.65; margin: 10px auto 36px;
    animation: fadeUp 0.5s 0.4s both;
  }
  .finale__text strong { color: var(--gold-bright); opacity: 1; }

  .finale__trophies { display: flex; gap: 32px; margin-bottom: 36px; }
  .trophy {
    text-align: center; opacity: 0;
    animation: trophyIn 0.7s var(--ease-bounce) forwards;
  }
  .trophy:nth-child(1) { animation-delay: 0.6s; }
  .trophy:nth-child(2) { animation-delay: 0.85s; }
  .trophy:nth-child(3) { animation-delay: 1.1s; }
  @keyframes trophyIn { from { opacity: 0; transform: translateY(40px) scale(0.4) rotate(-12deg); } to { opacity: 1; transform: none; } }

  .trophy__orb {
    width: 96px; height: 96px; border-radius: 24px;
    background: var(--t-bg); display: flex; align-items: center; justify-content: center;
    box-shadow: 0 8px 0 var(--t-shadow), 0 14px 40px rgba(0,0,0,0.35), 0 0 40px var(--t-glow);
    border: 3px solid var(--t-border);
    position: relative;
  }
  .trophy__orb svg { width: 62px; height: 62px; }
  .trophy__orb::after {
    content: ''; position: absolute; top: -6px; right: -6px;
    width: 28px; height: 28px; border-radius: 50%;
    background: linear-gradient(135deg, var(--teal), #26D0CE);
    box-shadow: 0 3px 10px var(--teal-glow);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'/%3E%3C/svg%3E");
    background-size: 15px; background-repeat: no-repeat; background-position: center;
  }
  .trophy__label {
    font-family: var(--font-display); font-size: 10px; font-weight: 700;
    color: var(--t-label); margin-top: 12px; letter-spacing: 0.5px;
  }

  .finale__loader {
    display: flex; align-items: center; gap: 14px;
    padding: 14px 28px; border-radius: 10px;
    background: rgba(240,199,94,0.06); border: 1px solid var(--gold)12;
    animation: fadeUp 0.5s 1.4s both;
  }
  .finale__spinner {
    width: 18px; height: 18px;
    border: 2.5px solid var(--gold)18; border-top-color: var(--gold-bright);
    border-radius: 50%; animation: spin 0.8s linear infinite;
  }
  .finale__loader-text {
    font-family: var(--font-display); font-size: 12px; font-weight: 700;
    color: var(--gold); opacity: 0.6; letter-spacing: 0.5px;
  }

  @keyframes fadeUp { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<!-- ══ The Night Sky ══ -->
<div class="sky">
  <div class="nebula nebula-1"></div>
  <div class="nebula nebula-2"></div>
  <div class="nebula nebula-3"></div>
  <div id="starField"></div>
  <div id="moteField"></div>
</div>

<!-- SVG Defs -->
<svg style="position:absolute;width:0;height:0;">
<defs>
  <filter id="constellationGlow">
    <feGaussianBlur stdDeviation="4" result="b"/>
    <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>

  <!-- Ignis -->
  <symbol id="char-ignis" viewBox="0 0 100 100">
    <path d="M20 72 Q50 65 80 72 L82 78 Q50 72 18 78Z" fill="#8B6914" opacity="0.7"/>
    <path d="M22 68 Q50 62 78 68 L80 74 Q50 68 20 74Z" fill="#D4AA3A"/>
    <line x1="50" y1="63" x2="50" y2="74" stroke="#B8941A" stroke-width="0.8" opacity="0.4"/>
    <path d="M50 14 C65 28,70 40,65 52 C62 58,56 62,50 62 C44 62,38 58,35 52 C30 40,35 28,50 14Z" fill="url(#flameGrad)"/>
    <path d="M50 24 C59 34,62 42,59 50 C57 54,54 56,50 56 C46 56,43 54,41 50 C38 42,41 34,50 24Z" fill="#FFD93D" opacity="0.9"/>
    <path d="M50 32 C55 38,56 43,54 48 C53 50,51 51,50 51 C49 51,47 50,46 48 C44 43,45 38,50 32Z" fill="#FFF4CC"/>
    <ellipse cx="44" cy="42" rx="3.5" ry="4" fill="#2D3436"/><ellipse cx="56" cy="42" rx="3.5" ry="4" fill="#2D3436"/>
    <ellipse cx="45" cy="40.5" rx="1.5" ry="1.8" fill="white"/><ellipse cx="57" cy="40.5" rx="1.5" ry="1.8" fill="white"/>
    <path d="M44 49 Q50 54,56 49" stroke="#C44D34" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M65 54 Q72 48 76 44" stroke="#FFB347" stroke-width="2" fill="none" stroke-linecap="round"/>
    <line x1="76" y1="44" x2="82" y2="34" stroke="#8B6914" stroke-width="1.5" stroke-linecap="round"/>
    <path d="M82 34 L86 28 L80 32Z" fill="#FF6B6B" opacity="0.7"/>
    <path d="M18 22 L20 16 L22 22 L28 24 L22 26 L20 32 L18 26 L12 24Z" fill="#FFE66D" opacity="0.8"><animate attributeName="opacity" values="0.8;0.3;0.8" dur="2s" repeatCount="indefinite"/></path>
  </symbol>

  <!-- Bloom -->
  <symbol id="char-bloom" viewBox="0 0 100 100">
    <ellipse cx="50" cy="78" rx="18" ry="5" fill="#5D4037" opacity="0.25"/>
    <rect x="44" y="68" width="12" height="14" rx="3" fill="#BCAAA4"/>
    <ellipse cx="50" cy="68" rx="20" ry="10" fill="#E57373" opacity="0.4"/>
    <circle cx="43" cy="66" r="2.5" fill="white" opacity="0.5"/><circle cx="56" cy="64" r="2" fill="white" opacity="0.4"/>
    <ellipse cx="50" cy="48" rx="16" ry="20" fill="url(#bloomGrad)"/>
    <ellipse cx="50" cy="46" rx="11" ry="12" fill="#C8E6C9" opacity="0.5"/>
    <ellipse cx="44" cy="44" rx="3.2" ry="3.8" fill="#2D3436"/><ellipse cx="56" cy="44" rx="3.2" ry="3.8" fill="#2D3436"/>
    <ellipse cx="44.8" cy="42.5" rx="1.3" ry="1.6" fill="white"/><ellipse cx="56.8" cy="42.5" rx="1.3" ry="1.6" fill="white"/>
    <ellipse cx="39" cy="49" rx="3.5" ry="2.2" fill="#FF8A80" opacity="0.35"/>
    <ellipse cx="61" cy="49" rx="3.5" ry="2.2" fill="#FF8A80" opacity="0.35"/>
    <path d="M46 51 Q50 55,54 51" stroke="#2D3436" stroke-width="1.3" fill="none" stroke-linecap="round"/>
    <ellipse cx="26" cy="42" rx="12" ry="7" fill="#A5D6A7" opacity="0.55" transform="rotate(-15 26 42)"/>
    <ellipse cx="74" cy="42" rx="12" ry="7" fill="#A5D6A7" opacity="0.55" transform="rotate(15 74 42)"/>
    <circle cx="42" cy="30" r="4" fill="#CE93D8" opacity="0.7"/><circle cx="42" cy="30" r="2" fill="#FFE66D"/>
    <circle cx="50" cy="27" r="5" fill="#E040FB" opacity="0.6"/><circle cx="50" cy="27" r="2.5" fill="#FFE66D"/>
    <circle cx="58" cy="30" r="4" fill="#F48FB1" opacity="0.6"/><circle cx="58" cy="30" r="2" fill="#FFE66D"/>
    <circle cx="16" cy="28" r="2" fill="#A5D6A7" opacity="0.5"><animate attributeName="cy" values="28;22;28" dur="3s" repeatCount="indefinite"/></circle>
  </symbol>

  <!-- Rumble -->
  <symbol id="char-rumble" viewBox="0 0 100 100">
    <ellipse cx="50" cy="82" rx="24" ry="4" fill="#546E7A" opacity="0.15"/>
    <path d="M28 50 C22 55,20 65,24 78 Q30 82,36 76 C32 65,30 58,32 52Z" fill="#E17055" opacity="0.5"/>
    <path d="M72 50 C78 55,80 65,76 78 Q70 82,64 76 C68 65,70 58,68 52Z" fill="#E17055" opacity="0.5"/>
    <ellipse cx="50" cy="42" rx="26" ry="20" fill="#B0BEC5"/>
    <ellipse cx="34" cy="44" rx="16" ry="14" fill="#B0BEC5"/>
    <ellipse cx="66" cy="44" rx="16" ry="14" fill="#B0BEC5"/>
    <ellipse cx="50" cy="38" rx="22" ry="18" fill="#CFD8DC"/>
    <ellipse cx="40" cy="34" rx="14" ry="12" fill="#E0E5E8"/><ellipse cx="58" cy="36" rx="13" ry="11" fill="#E0E5E8"/>
    <ellipse cx="42" cy="42" rx="3.5" ry="4" fill="#2D3436"/><ellipse cx="58" cy="42" rx="3.5" ry="4" fill="#2D3436"/>
    <ellipse cx="42.8" cy="40.5" rx="1.5" ry="1.8" fill="white"/><ellipse cx="58.8" cy="40.5" rx="1.5" ry="1.8" fill="white"/>
    <path d="M37 34 L44 36.5" stroke="#455A64" stroke-width="2.5" stroke-linecap="round"/>
    <path d="M63 34 L56 36.5" stroke="#455A64" stroke-width="2.5" stroke-linecap="round"/>
    <path d="M44 49 Q50 54,56 49" stroke="#2D3436" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <polygon points="44,58 48,58 46,66 52,66 40,82 44,70 38,70" fill="#FFD54F"/>
    <polygon points="56,60 59,60 57.5,66 62,66 54,76 56.5,68 53,68" fill="#FFD54F" opacity="0.7"/>
    <circle cx="20" cy="30" r="2.5" fill="#FFD54F" opacity="0.6"><animate attributeName="opacity" values="0.6;0.2;0.6" dur="1.5s" repeatCount="indefinite"/></circle>
  </symbol>

  <!-- Ollie -->
  <symbol id="char-ollie" viewBox="0 0 64 64">
    <ellipse cx="32" cy="42" rx="18" ry="20" fill="#8B6914"/>
    <ellipse cx="32" cy="40" rx="15" ry="17" fill="#A67C28"/>
    <ellipse cx="32" cy="46" rx="10" ry="12" fill="#D4AA3A" opacity="0.5"/>
    <ellipse cx="14" cy="40" rx="8" ry="12" fill="#8B6914" transform="rotate(-10 14 40)"/>
    <ellipse cx="50" cy="40" rx="8" ry="12" fill="#8B6914" transform="rotate(10 50 40)"/>
    <circle cx="24" cy="30" r="9" fill="white"/><circle cx="40" cy="30" r="9" fill="white"/>
    <circle cx="24" cy="30" r="5.5" fill="#3D2E1E"/><circle cx="40" cy="30" r="5.5" fill="#3D2E1E"/>
    <circle cx="25.5" cy="28" r="2" fill="white"/><circle cx="41.5" cy="28" r="2" fill="white"/>
    <circle cx="24" cy="30" r="10" fill="none" stroke="#5D4037" stroke-width="1.5"/>
    <circle cx="40" cy="30" r="10" fill="none" stroke="#5D4037" stroke-width="1.5"/>
    <line x1="34" y1="30" x2="30" y2="30" stroke="#5D4037" stroke-width="1.5"/>
    <line x1="14" y1="28" x2="10" y2="26" stroke="#5D4037" stroke-width="1.5"/>
    <line x1="50" y1="28" x2="54" y2="26" stroke="#5D4037" stroke-width="1.5"/>
    <path d="M29 36 L32 40 L35 36Z" fill="#FF8E53"/>
    <path d="M18 18 Q20 12,24 20" fill="#8B6914"/><path d="M46 18 Q44 12,40 20" fill="#8B6914"/>
    <path d="M24 60 L20 63 M24 60 L24 63 M24 60 L28 63" stroke="#D4AA3A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M40 60 L36 63 M40 60 L40 63 M40 60 L44 63" stroke="#D4AA3A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  </symbol>

  <linearGradient id="flameGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#FF6B6B"/><stop offset="40%" stop-color="#FF8E53"/><stop offset="100%" stop-color="#FFB347"/>
  </linearGradient>
  <linearGradient id="bloomGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#66BB6A"/><stop offset="100%" stop-color="#81C784"/>
  </linearGradient>
</defs>
</svg>

<!-- ══════════════ STAGE ══════════════ -->
<div class="stage">

  <!-- Constellation Map -->
  <div class="constellation">
    <div class="constellation__title">Your Quest</div>
    <div class="constellation__map" id="constMap">
      <svg class="constellation__lines" width="80" height="340" viewBox="0 0 80 340">
        <path class="line-bg" d="M40 0 C15 60,65 100,40 160 C15 220,65 260,40 340"/>
        <path class="line-glow" id="lineGlow" d="M40 0 C15 60,65 100,40 160 C15 220,65 260,40 340"
          stroke-dasharray="420" stroke-dashoffset="420"/>
      </svg>

      <div class="starnode starnode--visible" id="node0">
        <div class="starnode__tag" id="tag0">Current Quest</div>
        <div class="starnode__orb starnode__orb--active" id="orb0">
          <svg><use href="#char-ignis"/></svg>
        </div>
        <div class="starnode__name">Story Spark</div>
      </div>

      <div class="starnode starnode--hidden" id="node1">
        <div class="starnode__tag" id="tag1" style="display:none">Current Quest</div>
        <div class="starnode__orb starnode__orb--locked" id="orb1">
          <svg><use href="#char-bloom"/></svg>
        </div>
        <div class="starnode__name">Sense Weaver</div>
      </div>

      <div class="starnode starnode--hidden" id="node2">
        <div class="starnode__tag" id="tag2" style="display:none">Final Trial</div>
        <div class="starnode__orb starnode__orb--locked" id="orb2">
          <svg><use href="#char-rumble"/></svg>
        </div>
        <div class="starnode__name">Thunder Voice</div>
      </div>
    </div>
  </div>

  <!-- The Grimoire -->
  <div class="grimoire" id="grimoire">
    <div class="grimoire__page">
      <div class="grimoire__grain"></div>
      <div class="grimoire__margin"></div>
      <div class="grimoire__inner">

        <div class="page-head">
          <div class="page-head__badge" id="trialBadge">Trial I of III</div>
          <div class="page-head__title">
            <div class="page-head__icon" id="titleIcon"><svg><use href="#char-ignis"/></svg></div>
            <span id="titleText">The Story Spark</span>
          </div>
          <div class="counsel">
            <div class="counsel__avatar"><svg><use href="#char-ollie"/></svg></div>
            <div class="counsel__text" id="owlText">Every great quest begins with a story. Show me the spark of imagination inside you — write me a tale, and make it your own!</div>
          </div>
        </div>

        <div class="challenge">
          <div class="challenge__seal"><span class="challenge__seal-stamp">W</span></div>
          <div class="challenge__label">Your Challenge</div>
          <div class="challenge__prompt" id="promptText">Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?</div>
        </div>

        <div class="quill-pad">
          <textarea class="quill-pad__area" id="writingArea" placeholder="Begin writing here..." oninput="onType()"></textarea>
          <div class="quill-pad__sparks" id="sparkBox"></div>
        </div>

        <div class="footer-bar">
          <div class="ember-meter">
            <div class="ember-tube"><div class="ember-fill" id="emberFill"></div></div>
            <span class="ember-count" id="emberCount">0 / 20 words</span>
          </div>
          <button class="btn-submit" id="btnSubmit" onclick="submitTrial()">Prove It</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Celebration -->
<div class="celebration" id="celeb">
  <div class="celebration__bg"></div>
  <div class="celebration__body">
    <div class="celebration__icon" id="celebIcon"><svg width="80" height="80"><use href="#char-ignis"/></svg></div>
    <div class="celebration__title" id="celebTitle">Trial Passed!</div>
    <div class="celebration__sub" id="celebSub">...</div>
  </div>
</div>

<!-- Finale -->
<div class="finale" id="finale">
  <div class="finale__bg"></div>
  <div class="finale__stars" id="finaleStars"></div>
  <div class="finale__body">
    <div class="finale__owl"><svg><use href="#char-ollie"/></svg></div>
    <div class="finale__heading">You've proven yourself worthy!</div>
    <div class="finale__text">Welcome to the quest, <strong>Maya</strong>. Ollie is preparing your personal adventure path...</div>
    <div class="finale__trophies">
      <div class="trophy"><div class="trophy__orb" style="--t-bg:linear-gradient(150deg,#FFF3D4,#FFE4A8);--t-shadow:#C49A2A30;--t-glow:#FFD54F25;--t-border:#D4532A60;"><svg><use href="#char-ignis"/></svg></div><div class="trophy__label" style="--t-label:#FF8E53cc;">Story Spark</div></div>
      <div class="trophy"><div class="trophy__orb" style="--t-bg:linear-gradient(150deg,#E8F5E9,#C8E6C9);--t-shadow:#2E7D3230;--t-glow:#66BB6A25;--t-border:#66BB6A60;"><svg><use href="#char-bloom"/></svg></div><div class="trophy__label" style="--t-label:#81C784cc;">Sense Weaver</div></div>
      <div class="trophy"><div class="trophy__orb" style="--t-bg:linear-gradient(150deg,#ECEFF1,#CFD8DC);--t-shadow:#455A6430;--t-glow:#90A4AE25;--t-border:#90A4AE60;"><svg><use href="#char-rumble"/></svg></div><div class="trophy__label" style="--t-label:#B0BEC5cc;">Thunder Voice</div></div>
    </div>
    <div class="finale__loader"><div class="finale__spinner"></div><span class="finale__loader-text">Crafting your curriculum...</span></div>
  </div>
</div>

<script>
  // ── Star field ──
  (function(){
    const f = document.getElementById('starField');
    const types = ['star--gold','star--white','star--blue'];
    for (let i = 0; i < 55; i++) {
      const s = document.createElement('div');
      s.className = 'star ' + types[Math.floor(Math.random()*3)];
      s.style.left = (Math.random()*100)+'%';
      s.style.top = (Math.random()*80)+'%';
      const sz = 1 + Math.random()*3;
      s.style.width = sz+'px'; s.style.height = sz+'px';
      s.style.setProperty('--min-o', (0.05+Math.random()*0.15).toFixed(2));
      s.style.setProperty('--max-o', (0.5+Math.random()*0.45).toFixed(2));
      s.style.animationDuration = (2+Math.random()*4)+'s';
      s.style.animationDelay = (Math.random()*5)+'s';
      f.appendChild(s);
    }
  })();

  // ── Floating motes ──
  (function(){
    const f = document.getElementById('moteField');
    for (let i = 0; i < 12; i++) {
      const m = document.createElement('div');
      m.className = 'mote';
      m.style.left = (10+Math.random()*80)+'%';
      m.style.bottom = (Math.random()*30)+'%';
      m.style.setProperty('--mx', ((Math.random()-0.5)*40)+'px');
      m.style.animationDuration = (6+Math.random()*8)+'s';
      m.style.animationDelay = (Math.random()*10)+'s';
      f.appendChild(m);
    }
  })();

  // ── Finale stars ──
  (function(){
    const c = document.getElementById('finaleStars');
    for (let i = 0; i < 40; i++) {
      const s = document.createElement('div');
      s.className = 'star star--gold';
      s.style.left = (Math.random()*100)+'%'; s.style.top = (Math.random()*100)+'%';
      const sz = 1+Math.random()*3;
      s.style.width = sz+'px'; s.style.height = sz+'px';
      s.style.animationDuration = (1.5+Math.random()*2.5)+'s';
      s.style.animationDelay = (Math.random()*3)+'s';
      c.appendChild(s);
    }
  })();

  // ── Trial data ──
  let current = 0;
  const trials = [
    { badge:'Trial I of III', title:'The Story Spark', char:'#char-ignis', owl:"Every great quest begins with a story. Show me the spark of imagination inside you — write me a tale, and make it your own!", prompt:"Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?", celebTitle:'Story Spark — Proven!', celebSub:'I can feel the storytelling magic in you! A new trial awaits...' },
    { badge:'Trial II of III', title:'The Sense Weaver', char:'#char-bloom', owl:"A true writer doesn't just tell — they make readers SEE, HEAR, and FEEL. Show me you can weave the senses into your words!", prompt:"Describe your favorite place in the world so vividly that someone who's never been there can close their eyes and feel like they're standing right in it.", celebTitle:'Sense Weaver — Proven!', celebSub:'Brilliant! One final trial remains — the hardest one...' },
    { badge:'The Final Trial', title:'The Voice of Thunder', char:'#char-rumble', owl:"The mightiest power a writer has is the power to change minds. Show me your voice of thunder — convince me!", prompt:"Should kids have a say in what they learn at school? Pick a side and write your strongest argument to convince your principal.", celebTitle:'All Trials Complete!', celebSub:"You've done it, Maya! You are worthy." },
  ];
  const glowStops = [280, 140, 0];

  // ── Typing logic ──
  let lastType = 0;
  function onType() {
    const val = document.getElementById('writingArea').value;
    const words = val.trim().split(/\s+/).filter(Boolean).length;
    const pct = Math.min(words/20, 1);
    const fill = document.getElementById('emberFill');
    const label = document.getElementById('emberCount');
    const btn = document.getElementById('btnSubmit');

    fill.style.width = (pct*100)+'%';
    if (pct >= 1) {
      fill.classList.add('ember-fill--full');
      label.className = 'ember-count ember-count--ready';
      label.textContent = words + ' words \u2713';
      btn.className = 'btn-submit btn-submit--ready';
      if (current === 2) btn.textContent = 'Complete the Trial';
    } else {
      fill.classList.remove('ember-fill--full');
      label.className = 'ember-count';
      label.textContent = words + ' / 20 words';
      btn.className = 'btn-submit';
      btn.textContent = 'Prove It';
    }

    // Ink particles
    const now = Date.now();
    if (now - lastType > 80) { lastType = now; spawnInk(); }
  }

  function spawnInk() {
    const box = document.getElementById('sparkBox');
    const ta = document.getElementById('writingArea');
    for (let i = 0; i < 2; i++) {
      const p = document.createElement('div'); p.className = 'ink-mote';
      const x = 30 + Math.random() * (ta.offsetWidth - 60);
      const y = 15 + Math.random() * 50;
      p.style.left = x+'px'; p.style.top = y+'px';
      p.style.setProperty('--ix', ((Math.random()-0.5)*30)+'px');
      p.style.setProperty('--iy', (-(12+Math.random()*25))+'px');
      const colors = ['#C8973E','#D4532A','#F0C75E','#FFE8A3'];
      p.style.background = colors[Math.floor(Math.random()*4)];
      const sz = 2 + Math.random()*4;
      p.style.width = sz+'px'; p.style.height = sz+'px';
      box.appendChild(p);
      setTimeout(() => p.remove(), 1000);
    }
  }

  // ── Submit ──
  function submitTrial() {
    if (!document.getElementById('btnSubmit').classList.contains('btn-submit--ready')) return;
    const t = trials[current];

    // Mark done
    const orb = document.getElementById('orb'+current);
    orb.className = 'starnode__orb starnode__orb--done';
    orb.innerHTML += '<div class="starnode__check">\u2713</div>';
    document.getElementById('tag'+current).style.display = 'none';
    document.getElementById('node'+current).classList.add('starnode--done');

    // Constellation glow
    document.getElementById('lineGlow').style.strokeDashoffset = glowStops[current];

    showCeleb(t.char, t.celebTitle, t.celebSub);

    if (current < 2) {
      setTimeout(() => {
        current++;
        const nt = trials[current];

        // Reveal next node
        const node = document.getElementById('node'+current);
        node.classList.remove('starnode--hidden'); node.classList.add('starnode--visible');
        const no = document.getElementById('orb'+current);
        no.className = 'starnode__orb starnode__orb--active';
        document.getElementById('tag'+current).style.display = '';

        // Page turn
        const g = document.getElementById('grimoire');
        g.style.transition = 'opacity 0.35s, transform 0.35s';
        g.style.opacity = '0'; g.style.transform = 'translateY(10px) rotate(0.5deg) scale(0.98)';

        setTimeout(() => {
          document.getElementById('trialBadge').textContent = nt.badge;
          document.getElementById('titleText').textContent = nt.title;
          document.getElementById('titleIcon').innerHTML = '<svg><use href="'+nt.char+'"/></svg>';
          document.getElementById('owlText').textContent = nt.owl;
          document.getElementById('promptText').textContent = nt.prompt;
          document.getElementById('writingArea').value = '';
          document.getElementById('emberFill').style.width = '0%';
          document.getElementById('emberFill').classList.remove('ember-fill--full');
          document.getElementById('emberCount').className = 'ember-count';
          document.getElementById('emberCount').textContent = '0 / 20 words';
          document.getElementById('btnSubmit').className = 'btn-submit';
          document.getElementById('btnSubmit').textContent = 'Prove It';

          g.style.opacity = '1'; g.style.transform = 'translateY(0) rotate(0.3deg)';
        }, 350);

        hideCeleb();
      }, 2600);
    } else {
      setTimeout(() => {
        hideCeleb();
        setTimeout(() => {
          document.getElementById('finale').classList.add('finale--show');
          spawnConfetti(document.getElementById('finale'));
        }, 400);
      }, 3200);
    }
  }

  function showCeleb(charId, title, sub) {
    const el = document.getElementById('celeb');
    document.getElementById('celebIcon').innerHTML = '<svg width="80" height="80"><use href="'+charId+'"/></svg>';
    document.getElementById('celebTitle').textContent = title;
    document.getElementById('celebSub').textContent = sub;
    el.classList.add('celebration--show');
    spawnConfetti(el);
  }
  function hideCeleb() { document.getElementById('celeb').classList.remove('celebration--show'); }

  function spawnConfetti(container) {
    const colors = ['#F0C75E','#D4532A','#3ECFC4','#FF7B5C','#6C5CE7','#E17055','#FFE8A3','#A29BFE'];
    for (let i = 0; i < 60; i++) {
      const c = document.createElement('div'); c.className = 'confetti-bit';
      const sz = Math.random()*10+4;
      c.style.width = sz+'px'; c.style.height = (sz*(0.4+Math.random()*0.6))+'px';
      c.style.borderRadius = Math.random()>0.4?'50%':'1px';
      c.style.background = colors[i%colors.length];
      c.style.left = (20+Math.random()*60)+'%'; c.style.top = (15+Math.random()*20)+'%';
      c.style.setProperty('--fall',(300+Math.random()*500)+'px');
      c.style.setProperty('--spin',((Math.random()-0.5)*1600)+'deg');
      c.style.transform = 'translateX('+((Math.random()-0.5)*700)+'px)';
      c.style.animationDuration = (1.2+Math.random()*1.8)+'s';
      c.style.animationDelay = (Math.random()*0.6)+'s';
      container.appendChild(c);
      setTimeout(()=>c.remove(), 4000);
    }
  }
</script>
</body>
</html>
