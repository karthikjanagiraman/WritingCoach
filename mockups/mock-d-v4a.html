<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mock D v4a: Quest Trial</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Nunito', sans-serif; background: #FFF9F0; min-height: 100vh; overflow-x: hidden; }

  /* ‚ïê‚ïê Layout ‚ïê‚ïê */
  .main { display: flex; max-width: 1020px; margin: 0 auto; padding: 32px 24px 60px; gap: 28px; }

  /* ‚ïê‚ïê Left: Trail Sidebar ‚ïê‚ïê */
  .trail-sidebar { width: 180px; flex-shrink: 0; padding-top: 8px; }
  .trail-title { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; color: #2D343650; margin-bottom: 20px; text-align: center; }

  .trail-nodes { position: relative; }
  .trail-line { position: absolute; left: 38px; top: 40px; bottom: 40px; width: 3px; background: repeating-linear-gradient(to bottom, #2D343610 0, #2D343610 5px, transparent 5px, transparent 10px); }
  .trail-line-fill { position: absolute; left: 38px; top: 40px; width: 3px; height: 0; background: linear-gradient(180deg, #4ECDC4, #26D0CE); border-radius: 2px; transition: height 1s ease; }

  .trail-node { display: flex; align-items: center; gap: 12px; padding: 10px 0; position: relative; z-index: 2; transition: all 0.5s; }
  .trail-node.hidden-node { opacity: 0; height: 0; padding: 0; overflow: hidden; transform: translateX(-10px); }
  .trail-node.visible-node { opacity: 1; height: auto; transform: translateX(0); }

  /* ‚îÄ‚îÄ SVG Character Medallions ‚îÄ‚îÄ */
  .char-medallion { width: 76px; height: 76px; border-radius: 50%; flex-shrink: 0; position: relative; overflow: visible; }

  /* Trial 1: Ignis - Flame sprite on a book */
  .char-ignis { background: linear-gradient(135deg, #FFE8D6, #FFDAB9); border: 3px solid #FF6B6B30; box-shadow: 0 4px 16px #FF6B6B15; }
  .char-ignis .char-scene { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; }
  .char-ignis svg { width: 60px; height: 60px; }
  .char-ignis.active { border-color: #FF6B6B; box-shadow: 0 0 0 4px #FF6B6B15, 0 4px 20px #FF6B6B20; animation: medallionPulse 2.5s ease-in-out infinite; }
  .char-ignis.done { border-color: #4ECDC4; background: linear-gradient(135deg, #E8FFF9, #F0FFFC); }

  /* Trial 2: Bloom - Nature fairy */
  .char-bloom { background: linear-gradient(135deg, #E8E0FF, #D9CCFF); border: 3px solid #6C5CE730; box-shadow: 0 4px 16px #6C5CE715; }
  .char-bloom svg { width: 60px; height: 60px; }
  .char-bloom.active { border-color: #6C5CE7; box-shadow: 0 0 0 4px #6C5CE715, 0 4px 20px #6C5CE720; animation: medallionPulse 2.5s ease-in-out infinite; }
  .char-bloom.done { border-color: #4ECDC4; background: linear-gradient(135deg, #E8FFF9, #F0FFFC); }

  /* Trial 3: Rumble - Thunder cloud */
  .char-rumble { background: linear-gradient(135deg, #FFE4DB, #FFD5C8); border: 3px solid #E1705530; box-shadow: 0 4px 16px #E1705515; }
  .char-rumble svg { width: 60px; height: 60px; }
  .char-rumble.active { border-color: #E17055; box-shadow: 0 0 0 4px #E1705515, 0 4px 20px #E1705520; animation: medallionPulse 2.5s ease-in-out infinite; }
  .char-rumble.done { border-color: #4ECDC4; background: linear-gradient(135deg, #E8FFF9, #F0FFFC); }

  @keyframes medallionPulse {
    0%, 100% { box-shadow: 0 0 0 4px var(--glow, #FF6B6B15), 0 4px 20px var(--glow, #FF6B6B20); }
    50% { box-shadow: 0 0 0 8px var(--glow, #FF6B6B10), 0 4px 28px var(--glow, #FF6B6B28); }
  }

  .char-badge { position: absolute; top: -4px; right: -4px; width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(135deg, #4ECDC4, #26D0CE); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 900; box-shadow: 0 2px 8px #4ECDC450; z-index: 3; animation: popIn 0.4s cubic-bezier(0.34,1.56,0.64,1); }
  .char-medallion.locked { opacity: 0.3; border-style: dashed; filter: grayscale(0.8); }

  .node-info { min-width: 0; }
  .node-tag { font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.2px; color: var(--trial-accent, #FF6B6B); }
  .node-info.done .node-tag { color: #4ECDC4; }
  .node-name { font-size: 12px; font-weight: 800; color: #2D3436; line-height: 1.2; }

  /* ‚ïê‚ïê Right: Quest Panel ‚ïê‚ïê */
  .quest-panel { flex: 1; min-width: 0; }

  /* ‚îÄ‚îÄ Quest Card with illustrated header ‚îÄ‚îÄ */
  .quest-card { border-radius: 20px; overflow: hidden; background: white; box-shadow: 0 8px 40px rgba(0,0,0,0.06); }

  .quest-header {
    position: relative; padding: 28px 28px 20px; overflow: hidden;
    background: var(--header-bg, linear-gradient(135deg, #FF6B6B15, #FFE66D10));
  }
  .quest-header-scene {
    position: absolute; right: -10px; top: 50%; transform: translateY(-50%);
    opacity: 0.12; pointer-events: none;
  }
  .quest-header-content { position: relative; z-index: 2; }

  .quest-char-row { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; }
  .quest-char-portrait {
    width: 64px; height: 64px; border-radius: 16px; display: flex; align-items: center; justify-content: center;
    background: white; box-shadow: 0 4px 16px rgba(0,0,0,0.06); border: 2px solid var(--trial-accent, #FF6B6B20);
    flex-shrink: 0;
  }
  .quest-char-portrait svg { width: 44px; height: 44px; }
  .quest-char-info { flex: 1; }
  .quest-char-tag { font-size: 10px; font-weight: 800; color: var(--trial-accent, #FF6B6B); text-transform: uppercase; letter-spacing: 1.5px; }
  .quest-char-name { font-size: 20px; font-weight: 900; color: #2D3436; margin-top: 2px; }

  .quest-ollie-says {
    display: flex; align-items: flex-start; gap: 10px;
    padding: 12px 14px; background: white; border-radius: 14px;
    border: 1px solid #2D34360a;
    box-shadow: 0 2px 8px rgba(0,0,0,0.03);
  }
  .quest-ollie-avatar { font-size: 24px; flex-shrink: 0; line-height: 1; }
  .quest-ollie-text { font-size: 13.5px; font-weight: 600; color: #2D3436aa; line-height: 1.55; font-style: italic; }

  /* Quest body */
  .quest-body { padding: 24px 28px 28px; }

  .quest-prompt-label { font-size: 10px; font-weight: 800; color: #2D343640; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
  .quest-prompt {
    font-size: 15px; font-weight: 700; color: #2D3436; line-height: 1.6;
    padding: 14px 16px; border-radius: 12px;
    background: var(--prompt-bg, #FFF5EE);
    border-left: 4px solid var(--trial-accent, #FF6B6B);
    margin-bottom: 16px;
  }

  .quest-textarea {
    width: 100%; min-height: 200px; border: 2px solid #2D34360a; border-radius: 14px;
    padding: 16px; font-family: 'Literata', 'Georgia', serif; font-size: 15px;
    color: #2D3436; resize: vertical; outline: none; line-height: 1.8;
    transition: border-color 0.3s, box-shadow 0.3s;
    background: white;
  }
  .quest-textarea:focus { border-color: var(--trial-accent, #FF6B6B40); box-shadow: 0 0 0 4px var(--trial-glow, #FF6B6B08); }
  .quest-textarea::placeholder { color: #2D343618; }

  .quest-footer { display: flex; align-items: center; justify-content: space-between; margin-top: 14px; }
  .ink-meter { display: flex; align-items: center; gap: 10px; }
  .ink-bar { width: 100px; height: 8px; background: #2D34360a; border-radius: 4px; overflow: hidden; }
  .ink-fill { height: 100%; border-radius: 4px; transition: width 0.4s, background 0.4s; background: #2D343612; width: 0%; }
  .ink-fill.ready { background: linear-gradient(90deg, #4ECDC4, #26D0CE); }
  .ink-text { font-size: 12px; font-weight: 700; color: #2D343640; }
  .ink-text.ready { color: #4ECDC4; }

  .btn-submit {
    background: #e0e0e0; color: white; border: none; padding: 12px 32px;
    border-radius: 12px; font-size: 14px; font-weight: 800; cursor: not-allowed;
    font-family: inherit; transition: all 0.3s;
  }
  .btn-submit.ready {
    background: linear-gradient(135deg, var(--trial-accent, #FF6B6B), var(--trial-accent-light, #FF8E8E));
    cursor: pointer; box-shadow: 0 4px 16px var(--trial-glow, #FF6B6B25);
  }
  .btn-submit.ready:hover { transform: translateY(-2px); box-shadow: 0 6px 24px var(--trial-glow, #FF6B6B35); }

  /* ‚ïê‚ïê Celebration ‚ïê‚ïê */
  .celebration { position: fixed; inset: 0; z-index: 200; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.5s; }
  .celebration.show { opacity: 1; pointer-events: auto; }
  .celeb-bg { position: absolute; inset: 0; background: radial-gradient(ellipse, rgba(255,249,240,0.98), rgba(255,249,240,0.95)); }
  .celeb-content { position: relative; z-index: 2; text-align: center; }
  .celeb-char { margin-bottom: 8px; animation: celebBounce 0.6s cubic-bezier(0.34,1.56,0.64,1); }
  .celeb-char svg { width: 80px; height: 80px; }
  @keyframes celebBounce { 0% { transform: scale(0) rotate(-20deg); } 60% { transform: scale(1.15) rotate(5deg); } 100% { transform: scale(1) rotate(0); } }
  .celeb-title { font-size: 24px; font-weight: 900; color: #2D3436; margin: 8px 0; animation: fadeUp 0.4s 0.2s both; }
  .celeb-sub { font-size: 14px; font-weight: 600; color: #2D3436aa; max-width: 320px; line-height: 1.5; animation: fadeUp 0.4s 0.3s both; }
  .confetti { position: absolute; z-index: 1; animation: confettiFall linear forwards; }
  @keyframes confettiFall { 0% { transform: translateY(0) rotate(0) scale(1); opacity: 1; } 80% { opacity: 1; } 100% { transform: translateY(var(--fd,400px)) rotate(var(--rot,720deg)) scale(0.5); opacity: 0; } }

  /* ‚ïê‚ïê Final ‚ïê‚ïê */
  .final-screen { position: fixed; inset: 0; z-index: 200; background: linear-gradient(170deg, #FFF9F0, #FFE8D6); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 24px; opacity: 0; pointer-events: none; transition: opacity 0.6s; }
  .final-screen.show { opacity: 1; pointer-events: auto; }
  .final-emoji { font-size: 72px; margin-bottom: 8px; }
  .final-title { font-size: 26px; font-weight: 900; color: #2D3436; margin-bottom: 8px; }
  .final-sub { font-size: 15px; font-weight: 600; color: #2D3436aa; max-width: 360px; line-height: 1.6; text-align: center; }
  .final-chars { display: flex; gap: 24px; margin: 28px 0; }
  .final-char-item { text-align: center; opacity: 0; animation: badgeFly 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards; }
  .final-char-item:nth-child(1) { animation-delay: 0.3s; }
  .final-char-item:nth-child(2) { animation-delay: 0.5s; }
  .final-char-item:nth-child(3) { animation-delay: 0.7s; }
  @keyframes badgeFly { from { opacity: 0; transform: translateY(30px) scale(0.5); } to { opacity: 1; transform: translateY(0) scale(1); } }
  .final-char-circle { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid #4ECDC4; background: linear-gradient(135deg, #4ECDC410, white); box-shadow: 0 4px 20px #4ECDC420; }
  .final-char-circle svg { width: 52px; height: 52px; }
  .final-char-name { font-size: 11px; font-weight: 800; color: #2D3436aa; margin-top: 8px; }
  .final-loading { margin-top: 24px; display: flex; align-items: center; gap: 10px; }
  .final-spinner { width: 20px; height: 20px; border: 3px solid #FF6B6B15; border-top-color: #FF6B6B; border-radius: 50%; animation: spin 0.8s linear infinite; }
  .final-loading-text { font-size: 14px; font-weight: 700; color: #FF6B6Baa; }

  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<!-- SVG Definitions for Characters -->
<svg style="position:absolute;width:0;height:0;">
  <defs>
    <!-- Ignis: Flame sprite on a book -->
    <symbol id="char-ignis" viewBox="0 0 80 80">
      <!-- Book base -->
      <rect x="18" y="52" width="44" height="10" rx="2" fill="#8B6914" opacity="0.7"/>
      <rect x="20" y="48" width="40" height="10" rx="2" fill="#C49A2A"/>
      <rect x="20" y="49" width="40" height="2" fill="#D4AA3A"/>
      <line x1="40" y1="48" x2="40" y2="58" stroke="#8B6914" stroke-width="0.5" opacity="0.5"/>
      <!-- Flame body -->
      <path d="M40 12 C52 24, 56 34, 52 44 C50 48, 46 50, 40 50 C34 50, 30 48, 28 44 C24 34, 28 24, 40 12Z" fill="url(#flameGrad)"/>
      <path d="M40 22 C47 30, 49 36, 47 42 C45 46, 42 48, 40 48 C38 48, 35 46, 33 42 C31 36, 33 30, 40 22Z" fill="#FFE66D"/>
      <path d="M40 30 C44 34, 45 38, 43 42 C42 44, 41 45, 40 45 C39 45, 38 44, 37 42 C35 38, 36 34, 40 30Z" fill="#FFF4CC"/>
      <!-- Eyes -->
      <ellipse cx="36" cy="38" rx="2.5" ry="3" fill="#2D3436"/>
      <ellipse cx="44" cy="38" rx="2.5" ry="3" fill="#2D3436"/>
      <ellipse cx="36.5" cy="37" rx="1" ry="1.2" fill="white"/>
      <ellipse cx="44.5" cy="37" rx="1" ry="1.2" fill="white"/>
      <!-- Smile -->
      <path d="M37 42 Q40 45, 43 42" stroke="#2D3436" stroke-width="1.2" fill="none" stroke-linecap="round"/>
      <!-- Sparkles -->
      <circle cx="22" cy="20" r="2" fill="#FFE66D" opacity="0.8"/>
      <circle cx="58" cy="18" r="1.5" fill="#FF6B6B" opacity="0.7"/>
      <circle cx="16" cy="36" r="1.5" fill="#FFE66D" opacity="0.6"/>
      <circle cx="62" cy="32" r="2" fill="#FF8E8E" opacity="0.7"/>
      <path d="M26 14 L27 11 L28 14 L31 15 L28 16 L27 19 L26 16 L23 15Z" fill="#FFE66D" opacity="0.8"/>
      <path d="M54 24 L55 22 L56 24 L58 25 L56 26 L55 28 L54 26 L52 25Z" fill="#FF8E8E" opacity="0.7"/>
    </symbol>

    <!-- Bloom: Nature fairy with leaves -->
    <symbol id="char-bloom" viewBox="0 0 80 80">
      <!-- Leaf body -->
      <ellipse cx="40" cy="40" rx="18" ry="22" fill="url(#bloomGrad)"/>
      <!-- Leaf veins -->
      <path d="M40 22 L40 58" stroke="#4CAF50" stroke-width="0.8" opacity="0.3"/>
      <path d="M40 30 L30 26" stroke="#4CAF50" stroke-width="0.6" opacity="0.2"/>
      <path d="M40 30 L50 26" stroke="#4CAF50" stroke-width="0.6" opacity="0.2"/>
      <path d="M40 40 L28 36" stroke="#4CAF50" stroke-width="0.6" opacity="0.2"/>
      <path d="M40 40 L52 36" stroke="#4CAF50" stroke-width="0.6" opacity="0.2"/>
      <!-- Face area (lighter) -->
      <ellipse cx="40" cy="38" rx="13" ry="14" fill="#C8E6C9" opacity="0.6"/>
      <!-- Eyes -->
      <ellipse cx="35" cy="36" rx="2.5" ry="3" fill="#2D3436"/>
      <ellipse cx="45" cy="36" rx="2.5" ry="3" fill="#2D3436"/>
      <ellipse cx="35.5" cy="35" rx="1" ry="1.2" fill="white"/>
      <ellipse cx="45.5" cy="35" rx="1" ry="1.2" fill="white"/>
      <!-- Blush -->
      <ellipse cx="31" cy="40" rx="3" ry="2" fill="#FF8A80" opacity="0.3"/>
      <ellipse cx="49" cy="40" rx="3" ry="2" fill="#FF8A80" opacity="0.3"/>
      <!-- Smile -->
      <path d="M37 42 Q40 45.5, 43 42" stroke="#2D3436" stroke-width="1.2" fill="none" stroke-linecap="round"/>
      <!-- Tiny wings/petals -->
      <ellipse cx="20" cy="34" rx="8" ry="5" fill="#A5D6A7" opacity="0.6" transform="rotate(-20 20 34)"/>
      <ellipse cx="60" cy="34" rx="8" ry="5" fill="#A5D6A7" opacity="0.6" transform="rotate(20 60 34)"/>
      <!-- Crown flower -->
      <circle cx="40" cy="19" r="4" fill="#E040FB" opacity="0.6"/>
      <circle cx="36" cy="21" r="3" fill="#CE93D8" opacity="0.5"/>
      <circle cx="44" cy="21" r="3" fill="#CE93D8" opacity="0.5"/>
      <circle cx="40" cy="19" r="2" fill="#FFE66D"/>
      <!-- Floating particles -->
      <circle cx="14" cy="24" r="2" fill="#A5D6A7" opacity="0.5"/>
      <circle cx="66" cy="22" r="1.5" fill="#CE93D8" opacity="0.5"/>
      <circle cx="12" cy="50" r="1.5" fill="#81C784" opacity="0.4"/>
      <circle cx="68" cy="48" r="2" fill="#A5D6A7" opacity="0.5"/>
      <path d="M18 44 L19 41 L20 44 L23 45 L20 46 L19 49 L18 46 L15 45Z" fill="#81C784" opacity="0.5"/>
    </symbol>

    <!-- Rumble: Thunder cloud character -->
    <symbol id="char-rumble" viewBox="0 0 80 80">
      <!-- Cloud body -->
      <ellipse cx="40" cy="34" rx="22" ry="16" fill="url(#rumbleGrad)"/>
      <ellipse cx="28" cy="36" rx="12" ry="10" fill="#B0BEC5"/>
      <ellipse cx="52" cy="36" rx="12" ry="10" fill="#B0BEC5"/>
      <ellipse cx="40" cy="30" rx="18" ry="14" fill="#CFD8DC"/>
      <ellipse cx="34" cy="28" rx="10" ry="9" fill="#E0E5E8"/>
      <ellipse cx="48" cy="30" rx="9" ry="8" fill="#E0E5E8"/>
      <!-- Face -->
      <ellipse cx="35" cy="34" rx="2.5" ry="3" fill="#2D3436"/>
      <ellipse cx="47" cy="34" rx="2.5" ry="3" fill="#2D3436"/>
      <ellipse cx="35.5" cy="33" rx="1" ry="1.2" fill="white"/>
      <ellipse cx="47.5" cy="33" rx="1" ry="1.2" fill="white"/>
      <!-- Eyebrows (determined look) -->
      <line x1="32" y1="28" x2="37" y2="29.5" stroke="#546E7A" stroke-width="1.5" stroke-linecap="round"/>
      <line x1="50" y1="28" x2="45" y2="29.5" stroke="#546E7A" stroke-width="1.5" stroke-linecap="round"/>
      <!-- Grin -->
      <path d="M37 39 Q41 43, 45 39" stroke="#2D3436" stroke-width="1.3" fill="none" stroke-linecap="round"/>
      <!-- Lightning bolts -->
      <polygon points="36,46 40,46 38,54 43,54 34,66 37,56 32,56" fill="#FFD54F"/>
      <polygon points="36,46 40,46 38,54 43,54 34,66 37,56 32,56" fill="url(#boltGrad)" opacity="0.6"/>
      <polygon points="46,48 49,48 47.5,54 51,54 44,62 46,55 43,55" fill="#FFD54F" opacity="0.8"/>
      <!-- Spark particles -->
      <circle cx="18" cy="28" r="2" fill="#FFD54F" opacity="0.6"/>
      <circle cx="62" cy="26" r="1.5" fill="#FFD54F" opacity="0.5"/>
      <path d="M22 18 L23 15 L24 18 L27 19 L24 20 L23 23 L22 20 L19 19Z" fill="#FFD54F" opacity="0.6"/>
      <path d="M58 40 L59 38 L60 40 L62 41 L60 42 L59 44 L58 42 L56 41Z" fill="#FFD54F" opacity="0.5"/>
    </symbol>

    <!-- Gradients -->
    <linearGradient id="flameGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FF6B6B"/>
      <stop offset="50%" stop-color="#FF8E53"/>
      <stop offset="100%" stop-color="#FFB347"/>
    </linearGradient>
    <linearGradient id="bloomGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#66BB6A"/>
      <stop offset="100%" stop-color="#81C784"/>
    </linearGradient>
    <linearGradient id="rumbleGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#90A4AE"/>
      <stop offset="100%" stop-color="#B0BEC5"/>
    </linearGradient>
    <linearGradient id="boltGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#FFF9C4"/>
      <stop offset="100%" stop-color="#FFD54F"/>
    </linearGradient>
  </defs>
</svg>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="main" id="main">
  <!-- Left sidebar -->
  <div class="trail-sidebar">
    <div class="trail-title">Your Quest</div>
    <div class="trail-nodes" id="trailNodes">
      <div class="trail-line"></div>
      <div class="trail-line-fill" id="trailFill"></div>

      <div class="trail-node visible-node" id="node0">
        <div class="char-medallion char-ignis active" id="medal0" style="--glow:#FF6B6B15;">
          <div class="char-scene"><svg><use href="#char-ignis"/></svg></div>
        </div>
        <div class="node-info" id="info0">
          <div class="node-tag" style="--trial-accent:#FF6B6B;">Trial 1</div>
          <div class="node-name">Story Spark</div>
        </div>
      </div>

      <div class="trail-node hidden-node" id="node1">
        <div class="char-medallion char-bloom locked" id="medal1" style="--glow:#6C5CE715;">
          <div class="char-scene"><svg><use href="#char-bloom"/></svg></div>
        </div>
        <div class="node-info" id="info1">
          <div class="node-tag" style="--trial-accent:#6C5CE7;">Trial 2</div>
          <div class="node-name">Sense Weaver</div>
        </div>
      </div>

      <div class="trail-node hidden-node" id="node2">
        <div class="char-medallion char-rumble locked" id="medal2" style="--glow:#E1705515;">
          <div class="char-scene"><svg><use href="#char-rumble"/></svg></div>
        </div>
        <div class="node-info" id="info2">
          <div class="node-tag" style="--trial-accent:#E17055;">Final Trial</div>
          <div class="node-name">Thunder Voice</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right quest panel -->
  <div class="quest-panel" id="questPanel">
    <div class="quest-card" id="questCard" style="--trial-accent:#FF6B6B; --trial-accent-light:#FF8E8E; --trial-glow:#FF6B6B20; --header-bg:linear-gradient(135deg, #FF6B6B10, #FFE66D08); --prompt-bg:#FFF5EE;">
      <!-- Illustrated header -->
      <div class="quest-header" id="questHeader">
        <div class="quest-header-scene" id="questHeaderScene">
          <svg width="140" height="140"><use href="#char-ignis"/></svg>
        </div>
        <div class="quest-header-content">
          <div class="quest-char-row">
            <div class="quest-char-portrait" id="questPortrait">
              <svg><use href="#char-ignis"/></svg>
            </div>
            <div class="quest-char-info">
              <div class="quest-char-tag" id="questTag">Trial 1 of 3</div>
              <div class="quest-char-name" id="questCharName">The Story Spark</div>
            </div>
          </div>
          <div class="quest-ollie-says">
            <div class="quest-ollie-avatar">ü¶â</div>
            <div class="quest-ollie-text" id="questOllieSays">Every great quest begins with a story. Show me the spark of imagination inside you ‚Äî write me a tale, and make it your own!</div>
          </div>
        </div>
      </div>

      <!-- Writing body -->
      <div class="quest-body">
        <div class="quest-prompt-label">Your Challenge</div>
        <div class="quest-prompt" id="questPrompt">Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?</div>
        <textarea class="quest-textarea" id="questTextarea" placeholder="Start writing your story here..." oninput="onType()"></textarea>
        <div class="quest-footer">
          <div class="ink-meter">
            <div class="ink-bar"><div class="ink-fill" id="inkFill"></div></div>
            <span class="ink-text" id="inkText">0 / 20 words</span>
          </div>
          <button class="btn-submit" id="btnSubmit" onclick="submitTrial()">Prove It!</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Celebration -->
<div class="celebration" id="celebration">
  <div class="celeb-bg"></div>
  <div class="celeb-content">
    <div class="celeb-char" id="celebChar"><svg width="80" height="80"><use href="#char-ignis"/></svg></div>
    <div class="celeb-title" id="celebTitle">Trial Passed!</div>
    <div class="celeb-sub" id="celebSub">...</div>
  </div>
</div>

<!-- Final -->
<div class="final-screen" id="finalScreen">
  <div class="final-emoji">üéâ</div>
  <div class="final-title">You've proven yourself worthy!</div>
  <div class="final-sub">Welcome to the quest, <strong>Maya</strong>. Ollie is preparing your personal adventure path...</div>
  <div class="final-chars">
    <div class="final-char-item"><div class="final-char-circle"><svg><use href="#char-ignis"/></svg></div><div class="final-char-name">Story Spark</div></div>
    <div class="final-char-item"><div class="final-char-circle"><svg><use href="#char-bloom"/></svg></div><div class="final-char-name">Sense Weaver</div></div>
    <div class="final-char-item"><div class="final-char-circle"><svg><use href="#char-rumble"/></svg></div><div class="final-char-name">Thunder Voice</div></div>
  </div>
  <div class="final-loading"><div class="final-spinner"></div><span class="final-loading-text">Crafting your curriculum...</span></div>
</div>

<script>
  let currentTrial = 0;
  const trialThemes = [
    { accent: '#FF6B6B', accentLight: '#FF8E8E', glow: '#FF6B6B20', headerBg: 'linear-gradient(135deg, #FF6B6B10, #FFE66D08)', promptBg: '#FFF5EE', char: '#char-ignis', tag: 'Trial 1 of 3', name: 'The Story Spark', medalClass: 'char-ignis' },
    { accent: '#6C5CE7', accentLight: '#A29BFE', glow: '#6C5CE720', headerBg: 'linear-gradient(135deg, #6C5CE710, #A29BFE08)', promptBg: '#F3F0FF', char: '#char-bloom', tag: 'Trial 2 of 3', name: 'The Sense Weaver', medalClass: 'char-bloom' },
    { accent: '#E17055', accentLight: '#FAB1A0', glow: '#E1705520', headerBg: 'linear-gradient(135deg, #E1705510, #FFD54F08)', promptBg: '#FFF3EE', char: '#char-rumble', tag: 'Final Trial', name: 'The Voice of Thunder', medalClass: 'char-rumble' },
  ];
  const trials = [
    { ollie: "Every great quest begins with a story. Show me the spark of imagination inside you ‚Äî write me a tale, and make it your own!", prompt: "Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?", celebTitle: 'Story Spark ‚Äî Proven!', celebSub: "I can feel the storytelling magic in you! A new trial awaits..." },
    { ollie: "A true writer doesn't just tell ‚Äî they make readers SEE, HEAR, and FEEL. Show me you can weave the senses into your words!", prompt: "Describe your favorite place in the world so vividly that someone who's never been there can close their eyes and feel like they're standing right in it.", celebTitle: 'Sense Weaver ‚Äî Proven!', celebSub: "Brilliant! One final trial remains ‚Äî the hardest one..." },
    { ollie: "The mightiest power a writer has is the power to change minds. Show me your voice of thunder ‚Äî convince me!", prompt: "Should kids have a say in what they learn at school? Pick a side and write your strongest argument to convince your principal.", celebTitle: 'All Trials Complete!', celebSub: "You've done it, Maya! You are worthy." },
  ];
  const fillHeights = [0, 76, 152];

  function onType() {
    const words = document.getElementById('questTextarea').value.trim().split(/\s+/).filter(Boolean).length;
    const pct = Math.min(words / 20, 1);
    const fill = document.getElementById('inkFill');
    const txt = document.getElementById('inkText');
    const btn = document.getElementById('btnSubmit');
    fill.style.width = (pct * 100) + '%';
    txt.textContent = words + ' / 20 words';
    if (pct >= 1) { fill.classList.add('ready'); txt.classList.add('ready'); txt.textContent = words + ' words ‚úì'; btn.classList.add('ready'); if (currentTrial===2) btn.textContent='Complete the Trial!'; }
    else { fill.classList.remove('ready'); txt.classList.remove('ready'); btn.classList.remove('ready'); btn.textContent='Prove It!'; }
  }

  function submitTrial() {
    if (!document.getElementById('btnSubmit').classList.contains('ready')) return;
    const t = trials[currentTrial], th = trialThemes[currentTrial];
    // Mark done
    const medal = document.getElementById('medal' + currentTrial);
    medal.classList.remove('active'); medal.classList.add('done');
    medal.innerHTML += '<div class="char-badge">‚úì</div>';
    document.getElementById('info' + currentTrial).classList.add('done');
    document.getElementById('info' + currentTrial).querySelector('.node-tag').textContent = 'Passed!';
    document.getElementById('trailFill').style.height = fillHeights[currentTrial] + 'px';

    showCeleb(th.char, t.celebTitle, t.celebSub);
    if (currentTrial < 2) {
      setTimeout(() => {
        currentTrial++;
        const nt = trialThemes[currentTrial], nd = trials[currentTrial];
        // Reveal node
        document.getElementById('node' + currentTrial).classList.remove('hidden-node');
        document.getElementById('node' + currentTrial).classList.add('visible-node');
        const nm = document.getElementById('medal' + currentTrial);
        nm.classList.remove('locked'); nm.classList.add('active');
        // Update card
        const card = document.getElementById('questCard');
        card.style.setProperty('--trial-accent', nt.accent);
        card.style.setProperty('--trial-accent-light', nt.accentLight);
        card.style.setProperty('--trial-glow', nt.glow);
        card.style.setProperty('--header-bg', nt.headerBg);
        card.style.setProperty('--prompt-bg', nt.promptBg);
        document.getElementById('questPortrait').innerHTML = '<svg><use href="'+nt.char+'"/></svg>';
        document.getElementById('questHeaderScene').innerHTML = '<svg width="140" height="140"><use href="'+nt.char+'"/></svg>';
        document.getElementById('questTag').textContent = nt.tag;
        document.getElementById('questCharName').textContent = nt.name;
        document.getElementById('questOllieSays').textContent = nd.ollie;
        document.getElementById('questPrompt').textContent = nd.prompt;
        document.getElementById('questTextarea').value = '';
        document.getElementById('inkFill').style.width = '0%'; document.getElementById('inkFill').classList.remove('ready');
        document.getElementById('inkText').textContent = '0 / 20 words'; document.getElementById('inkText').classList.remove('ready');
        document.getElementById('btnSubmit').classList.remove('ready'); document.getElementById('btnSubmit').textContent = 'Prove It!';
        hideCeleb();
      }, 2500);
    } else {
      setTimeout(() => { hideCeleb(); setTimeout(() => { document.getElementById('finalScreen').classList.add('show'); spawnConfetti(document.getElementById('finalScreen')); }, 300); }, 3000);
    }
  }

  function showCeleb(charId, title, sub) {
    const el = document.getElementById('celebration');
    document.getElementById('celebChar').innerHTML = '<svg width="80" height="80"><use href="'+charId+'"/></svg>';
    document.getElementById('celebTitle').textContent = title;
    document.getElementById('celebSub').textContent = sub;
    el.classList.add('show');
    spawnConfetti(el);
  }
  function hideCeleb() { document.getElementById('celebration').classList.remove('show'); }

  function spawnConfetti(container) {
    const colors = ['#FF6B6B','#4ECDC4','#FFE66D','#6C5CE7','#00B894','#E17055'];
    for (let i = 0; i < 45; i++) {
      const c = document.createElement('div'); c.className = 'confetti';
      const s = Math.random()*9+4;
      c.style.width=s+'px'; c.style.height=(s*(Math.random()*0.6+0.4))+'px';
      c.style.borderRadius = Math.random()>0.5?'50%':'2px';
      c.style.background = colors[i%colors.length];
      c.style.left = (30+Math.random()*40)+'%'; c.style.top = (25+Math.random()*15)+'%';
      c.style.setProperty('--fd',(200+Math.random()*400)+'px');
      c.style.setProperty('--rot',((Math.random()-0.5)*1440)+'deg');
      c.style.transform='translateX('+((Math.random()-0.5)*500)+'px)';
      c.style.animationDuration=(1+Math.random()*1.5)+'s';
      c.style.animationDelay=(Math.random()*0.4)+'s';
      container.appendChild(c);
      setTimeout(()=>c.remove(),3000);
    }
  }
</script>
</body>
</html>
