<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mock D v5d: Adventure Academy</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&family=Literata:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    min-height: 100vh; overflow-x: hidden;
    background: #FFF9F0;
    color: #2D3436;
  }

  /* ══════════════════════════════════════════
     SHARED
  ══════════════════════════════════════════ */
  .screen {
    position: fixed; inset: 0; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    transition: opacity 0.5s, transform 0.5s;
    overflow: hidden;
  }
  .screen.hidden { opacity: 0; pointer-events: none; transform: scale(0.97); }
  .screen.visible { opacity: 1; pointer-events: auto; transform: scale(1); }

  /* Progress dots — tiny, always top-center */
  .progress-dots {
    display: flex; align-items: center; gap: 8px;
    position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
    z-index: 10;
  }
  .dot {
    width: 12px; height: 12px; border-radius: 50%;
    transition: all 0.4s;
  }
  .dot.done { background: #4ECDC4; box-shadow: 0 0 0 2px #4ECDC430; }
  .dot.active { background: #FF6B6B; box-shadow: 0 0 0 3px #FF6B6B25; animation: dotPulse 2s ease-in-out infinite; }
  .dot.locked { background: #e0d8cc; }
  .dot-line { width: 32px; height: 3px; border-radius: 2px; background: #e8e2da; transition: background 0.6s; }
  .dot-line.filled { background: linear-gradient(90deg, #4ECDC4, #FFE66D); }
  @keyframes dotPulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.25); } }

  .dot-check {
    font-size: 8px; color: white; font-weight: 900;
    display: flex; align-items: center; justify-content: center;
    width: 100%; height: 100%;
  }

  /* ══════════════════════════════════════════
     MODE A: CHALLENGE INTRO
  ══════════════════════════════════════════ */
  .intro-screen {
    background: #FFF9F0;
    padding: 60px 24px 40px;
  }

  .intro-content {
    max-width: 480px; width: 100%;
    display: flex; flex-direction: column; align-items: center;
    text-align: center;
  }

  .intro-character {
    width: 120px; height: 120px; border-radius: 32px;
    display: flex; align-items: center; justify-content: center;
    background: linear-gradient(145deg, #FFF3D4, #FFE4A8);
    box-shadow:
      0 8px 0 #e6c84a25,
      0 12px 32px rgba(0,0,0,0.08),
      inset 0 2px 4px rgba(255,255,255,0.6);
    margin-bottom: 20px;
    animation: introCharEnter 0.6s cubic-bezier(0.34,1.56,0.64,1) both;
  }
  .intro-character svg { width: 80px; height: 80px; }
  @keyframes introCharEnter {
    from { opacity: 0; transform: scale(0.5) translateY(20px) rotate(-10deg); }
    to { opacity: 1; transform: scale(1) translateY(0) rotate(0); }
  }

  .intro-trial-label {
    font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
    color: #FF6B6B; margin-bottom: 8px;
    animation: fadeUp 0.4s 0.2s both;
  }
  .intro-title {
    font-size: 28px; font-weight: 900; color: #2D3436; margin-bottom: 16px;
    line-height: 1.2;
    animation: fadeUp 0.4s 0.3s both;
  }

  /* Ollie mentor speech */
  .intro-mentor {
    display: flex; align-items: flex-start; gap: 12px;
    text-align: left; width: 100%;
    padding: 16px 18px;
    background: white;
    border-radius: 18px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.05);
    margin-bottom: 24px;
    animation: fadeUp 0.4s 0.4s both;
  }
  .intro-mentor-owl {
    width: 44px; height: 44px; flex-shrink: 0;
    background: linear-gradient(145deg, #C49A2A, #8B6914);
    border-radius: 14px;
    box-shadow: 0 3px 0 #4A340D30, inset 0 1px 2px rgba(255,255,255,0.2);
    display: flex; align-items: center; justify-content: center;
  }
  .intro-mentor-owl svg { width: 32px; height: 32px; }
  .intro-mentor-text {
    flex: 1; font-size: 15px; font-weight: 600; color: #636e72;
    line-height: 1.6; font-style: italic;
  }

  /* Challenge prompt card */
  .intro-prompt {
    width: 100%; padding: 20px 24px;
    background: linear-gradient(135deg, #FFF5E6, #FFF0D8);
    border-radius: 18px;
    border-left: 4px solid #FF6B6B;
    text-align: left;
    margin-bottom: 32px;
    animation: fadeUp 0.4s 0.5s both;
  }
  .intro-prompt-label {
    font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.5px;
    color: #FF6B6B; margin-bottom: 6px;
  }
  .intro-prompt-text {
    font-size: 16px; font-weight: 700; color: #2D3436; line-height: 1.6;
  }

  /* Start button */
  .btn-start {
    border: none; padding: 18px 48px; border-radius: 18px;
    font-family: inherit; font-size: 17px; font-weight: 900;
    color: white; cursor: pointer;
    background: linear-gradient(145deg, #FF6B6B, #FF5252);
    box-shadow:
      0 6px 0 #d44040,
      0 10px 28px rgba(255,107,107,0.25);
    transition: all 0.2s;
    animation: fadeUp 0.4s 0.6s both;
    position: relative; overflow: hidden;
  }
  .btn-start:hover { transform: translateY(-2px); box-shadow: 0 8px 0 #d44040, 0 14px 32px rgba(255,107,107,0.3); }
  .btn-start:active { transform: translateY(2px); box-shadow: 0 2px 0 #d44040; }
  .btn-start::after {
    content: ''; position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: btnSweep 3s ease-in-out infinite;
  }
  @keyframes btnSweep { 0%,100% { left: -100%; } 50% { left: 150%; } }

  /* ══════════════════════════════════════════
     MODE B: WRITING FOCUS
  ══════════════════════════════════════════ */
  .write-screen {
    background: #FFF9F0;
    padding: 52px 24px 24px;
    justify-content: flex-start;
  }

  .write-content {
    max-width: 640px; width: 100%;
    display: flex; flex-direction: column;
    flex: 1;
  }

  /* Pinned prompt banner */
  .write-prompt-bar {
    padding: 14px 20px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    margin-bottom: 16px;
    border-left: 4px solid #FF6B6B;
    animation: fadeUp 0.3s both;
  }
  .write-prompt-text {
    font-size: 15px; font-weight: 700; color: #2D3436; line-height: 1.55;
  }

  /* Writing area — dominant */
  .write-area-wrap {
    flex: 1; display: flex; flex-direction: column;
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    border: 2px solid #FF6B6B15;
    overflow: hidden;
    min-height: 300px;
    animation: fadeUp 0.3s 0.1s both;
    position: relative;
    transition: border-color 0.3s;
  }
  .write-area-wrap:focus-within {
    border-color: #FF6B6B30;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06), 0 0 0 4px #FF6B6B08;
  }

  .write-textarea {
    flex: 1; width: 100%; border: none; resize: none; outline: none;
    padding: 24px 28px;
    font-family: 'Literata', 'Georgia', serif; font-size: 17px;
    color: #2D3436; line-height: 2;
    background: transparent;
    background-image: repeating-linear-gradient(
      transparent, transparent 33px, #FF6B6B06 33px, #FF6B6B06 34px
    );
  }
  .write-textarea::placeholder { color: #b2bec3; font-style: italic; }

  /* Spark particles */
  .spark-container { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
  .spark {
    position: absolute; width: 4px; height: 4px; border-radius: 50%;
    pointer-events: none;
    animation: sparkFly 0.8s ease-out forwards;
  }
  @keyframes sparkFly {
    0% { opacity: 1; transform: translate(0,0) scale(1); }
    100% { opacity: 0; transform: translate(var(--sx), var(--sy)) scale(0); }
  }

  /* Bottom bar inside writing area */
  .write-bottom {
    display: flex; align-items: center; justify-content: space-between;
    padding: 12px 20px;
    border-top: 1px solid #f0ece6;
    background: #FEFCF8;
  }

  .word-meter {
    display: flex; align-items: center; gap: 10px;
  }
  .meter-bar {
    width: 140px; height: 8px; border-radius: 4px;
    background: #f0ece6; overflow: hidden;
  }
  .meter-fill {
    height: 100%; width: 0%; border-radius: 4px;
    background: linear-gradient(90deg, #FF6B6B, #FF8E53, #FFE66D);
    transition: width 0.4s ease;
  }
  .meter-fill.full { box-shadow: 0 0 8px #FF6B6B30; }
  .meter-label {
    font-size: 13px; font-weight: 700; color: #b2bec3;
    white-space: nowrap;
  }
  .meter-label.ready { color: #4ECDC4; }

  .btn-submit {
    border: none; padding: 12px 28px; border-radius: 14px;
    font-family: inherit; font-size: 14px; font-weight: 800;
    cursor: not-allowed;
    transition: all 0.4s;
    color: #ccc;
    background: #eee8e0;
  }
  .btn-submit.ready {
    cursor: pointer; color: white;
    background: linear-gradient(145deg, #FF6B6B, #FF5252);
    box-shadow: 0 4px 0 #d44040, 0 6px 16px rgba(255,107,107,0.2);
    animation: btnReady 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes btnReady { from { transform: scale(0.9); } to { transform: scale(1); } }
  .btn-submit.ready:hover { transform: translateY(-2px); }
  .btn-submit.ready:active { transform: translateY(1px); box-shadow: 0 2px 0 #d44040; }

  /* ══════════════════════════════════════════
     CELEBRATION OVERLAY
  ══════════════════════════════════════════ */
  .celebration {
    position: fixed; inset: 0; z-index: 200;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    background: radial-gradient(ellipse at 50% 40%, #FFF9F0f5, #FFF0E0f8);
    opacity: 0; pointer-events: none; transition: opacity 0.5s;
  }
  .celebration.show { opacity: 1; pointer-events: auto; }

  .celeb-icon {
    width: 120px; height: 120px; margin-bottom: 16px; border-radius: 50%;
    background: linear-gradient(145deg, #FFF3D4, #FFE4A8);
    box-shadow: 0 8px 0 #e6c84a20, 0 12px 32px rgba(0,0,0,0.08);
    display: flex; align-items: center; justify-content: center;
    animation: celebBounce 0.6s cubic-bezier(0.34,1.56,0.64,1);
  }
  .celeb-icon svg { width: 76px; height: 76px; }
  @keyframes celebBounce { 0% { transform: scale(0) rotate(-20deg); } 60% { transform: scale(1.1) rotate(5deg); } 100% { transform: scale(1) rotate(0); } }

  .celeb-title { font-size: 28px; font-weight: 900; color: #FF6B6B; margin-bottom: 6px; animation: fadeUp 0.4s 0.2s both; }
  .celeb-sub { font-size: 15px; font-weight: 600; color: #636e72; max-width: 340px; line-height: 1.55; text-align: center; animation: fadeUp 0.4s 0.3s both; }
  .celeb-progress { margin-top: 20px; font-size: 13px; font-weight: 800; color: #4ECDC4; animation: fadeUp 0.4s 0.4s both; }

  .confetti { position: absolute; z-index: 1; animation: confettiFall linear forwards; }
  @keyframes confettiFall { 0% { transform: translateY(0) rotate(0) scale(1); opacity: 1; } 80% { opacity: 1; } 100% { transform: translateY(var(--fd,400px)) rotate(var(--rot,720deg)) scale(0.5); opacity: 0; } }

  /* ══════════════════════════════════════════
     FINALE SCREEN
  ══════════════════════════════════════════ */
  .final-screen {
    position: fixed; inset: 0; z-index: 200;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 32px;
    background: radial-gradient(ellipse at 50% 40%, #FFF9F0, #FFF0E0, #FFE8D0);
    opacity: 0; pointer-events: none; transition: opacity 0.8s;
  }
  .final-screen.show { opacity: 1; pointer-events: auto; }

  .final-owl { margin-bottom: 8px; animation: ollieFloat 0.8s cubic-bezier(0.34,1.56,0.64,1); }
  .final-owl svg { width: 80px; height: 80px; filter: drop-shadow(0 4px 12px rgba(0,0,0,0.1)); }
  @keyframes ollieFloat { 0% { transform: scale(0) translateY(40px); } 60% { transform: scale(1.15) translateY(-10px); } 100% { transform: scale(1) translateY(0); } }

  .final-title { font-size: 28px; font-weight: 900; color: #FF6B6B; margin-bottom: 10px; text-align: center; animation: fadeUp 0.5s 0.2s both; }
  .final-sub { font-size: 15px; font-weight: 600; color: #636e72; max-width: 380px; line-height: 1.6; text-align: center; margin: 0 auto 28px; animation: fadeUp 0.5s 0.3s both; }

  .final-badges { display: flex; gap: 20px; margin-bottom: 28px; }
  .final-badge { text-align: center; opacity: 0; animation: badgeReveal 0.5s cubic-bezier(0.34,1.56,0.64,1) forwards; }
  .final-badge:nth-child(1) { animation-delay: 0.5s; }
  .final-badge:nth-child(2) { animation-delay: 0.7s; }
  .final-badge:nth-child(3) { animation-delay: 0.9s; }
  @keyframes badgeReveal { from { opacity: 0; transform: translateY(20px) scale(0.6); } to { opacity: 1; transform: translateY(0) scale(1); } }

  .final-badge-icon {
    width: 72px; height: 72px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    position: relative;
  }
  .final-badge-icon svg { width: 46px; height: 46px; }
  .final-badge-icon::after {
    content: ''; position: absolute; top: -3px; right: -3px;
    width: 22px; height: 22px; border-radius: 50%;
    background: linear-gradient(135deg, #4ECDC4, #26D0CE);
    box-shadow: 0 2px 6px #4ECDC440;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'/%3E%3C/svg%3E");
    background-size: 12px; background-repeat: no-repeat; background-position: center;
  }
  .final-badge-name { font-size: 12px; font-weight: 800; color: #636e72; margin-top: 8px; }

  .final-loading {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 20px; border-radius: 14px;
    background: #FF6B6B08; border: 1px solid #FF6B6B10;
    animation: fadeUp 0.5s 1.2s both;
  }
  .final-spinner { width: 18px; height: 18px; border: 3px solid #FF6B6B15; border-top-color: #FF6B6B; border-radius: 50%; animation: spin 0.8s linear infinite; }
  .final-loading-text { font-size: 13px; font-weight: 700; color: #636e72; }

  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes spin { to { transform: rotate(360deg); } }
</style>
</head>
<body>

<!-- SVG Defs -->
<svg style="position:absolute;width:0;height:0;">
<defs>
  <symbol id="char-ignis" viewBox="0 0 100 100">
    <path d="M20 72 Q50 65 80 72 L82 78 Q50 72 18 78Z" fill="#8B6914" opacity="0.7"/>
    <path d="M22 68 Q50 62 78 68 L80 74 Q50 68 20 74Z" fill="#D4AA3A"/>
    <line x1="50" y1="63" x2="50" y2="74" stroke="#B8941A" stroke-width="0.8" opacity="0.4"/>
    <path d="M50 14 C65 28, 70 40, 65 52 C62 58, 56 62, 50 62 C44 62, 38 58, 35 52 C30 40, 35 28, 50 14Z" fill="url(#flameGrad)"/>
    <path d="M50 24 C59 34, 62 42, 59 50 C57 54, 54 56, 50 56 C46 56, 43 54, 41 50 C38 42, 41 34, 50 24Z" fill="#FFD93D" opacity="0.9"/>
    <path d="M50 32 C55 38, 56 43, 54 48 C53 50, 51 51, 50 51 C49 51, 47 50, 46 48 C44 43, 45 38, 50 32Z" fill="#FFF4CC"/>
    <ellipse cx="44" cy="42" rx="3.5" ry="4" fill="#2D3436"/>
    <ellipse cx="56" cy="42" rx="3.5" ry="4" fill="#2D3436"/>
    <ellipse cx="45" cy="40.5" rx="1.5" ry="1.8" fill="white"/>
    <ellipse cx="57" cy="40.5" rx="1.5" ry="1.8" fill="white"/>
    <path d="M44 49 Q50 54, 56 49" stroke="#C44D34" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M65 54 Q72 48 76 44" stroke="#FFB347" stroke-width="2" fill="none" stroke-linecap="round"/>
    <line x1="76" y1="44" x2="82" y2="34" stroke="#8B6914" stroke-width="1.5" stroke-linecap="round"/>
    <path d="M82 34 L86 28 L80 32Z" fill="#FF6B6B" opacity="0.7"/>
    <path d="M18 22 L20 16 L22 22 L28 24 L22 26 L20 32 L18 26 L12 24Z" fill="#FFE66D" opacity="0.8"><animate attributeName="opacity" values="0.8;0.3;0.8" dur="2s" repeatCount="indefinite"/></path>
  </symbol>

  <symbol id="char-bloom" viewBox="0 0 100 100">
    <ellipse cx="50" cy="78" rx="18" ry="5" fill="#5D4037" opacity="0.25"/>
    <rect x="44" y="68" width="12" height="14" rx="3" fill="#BCAAA4"/>
    <ellipse cx="50" cy="68" rx="20" ry="10" fill="#E57373" opacity="0.4"/>
    <circle cx="43" cy="66" r="2.5" fill="white" opacity="0.5"/>
    <circle cx="56" cy="64" r="2" fill="white" opacity="0.4"/>
    <ellipse cx="50" cy="48" rx="16" ry="20" fill="url(#bloomGrad)"/>
    <ellipse cx="50" cy="46" rx="11" ry="12" fill="#C8E6C9" opacity="0.5"/>
    <ellipse cx="44" cy="44" rx="3.2" ry="3.8" fill="#2D3436"/>
    <ellipse cx="56" cy="44" rx="3.2" ry="3.8" fill="#2D3436"/>
    <ellipse cx="44.8" cy="42.5" rx="1.3" ry="1.6" fill="white"/>
    <ellipse cx="56.8" cy="42.5" rx="1.3" ry="1.6" fill="white"/>
    <ellipse cx="39" cy="49" rx="3.5" ry="2.2" fill="#FF8A80" opacity="0.35"/>
    <ellipse cx="61" cy="49" rx="3.5" ry="2.2" fill="#FF8A80" opacity="0.35"/>
    <path d="M46 51 Q50 55, 54 51" stroke="#2D3436" stroke-width="1.3" fill="none" stroke-linecap="round"/>
    <ellipse cx="26" cy="42" rx="12" ry="7" fill="#A5D6A7" opacity="0.55" transform="rotate(-15 26 42)"/>
    <ellipse cx="74" cy="42" rx="12" ry="7" fill="#A5D6A7" opacity="0.55" transform="rotate(15 74 42)"/>
    <circle cx="42" cy="30" r="4" fill="#CE93D8" opacity="0.7"/><circle cx="42" cy="30" r="2" fill="#FFE66D"/>
    <circle cx="50" cy="27" r="5" fill="#E040FB" opacity="0.6"/><circle cx="50" cy="27" r="2.5" fill="#FFE66D"/>
    <circle cx="58" cy="30" r="4" fill="#F48FB1" opacity="0.6"/><circle cx="58" cy="30" r="2" fill="#FFE66D"/>
  </symbol>

  <symbol id="char-rumble" viewBox="0 0 100 100">
    <ellipse cx="50" cy="82" rx="24" ry="4" fill="#546E7A" opacity="0.15"/>
    <path d="M28 50 C22 55, 20 65, 24 78 Q30 82, 36 76 C32 65, 30 58, 32 52Z" fill="#E17055" opacity="0.5"/>
    <path d="M72 50 C78 55, 80 65, 76 78 Q70 82, 64 76 C68 65, 70 58, 68 52Z" fill="#E17055" opacity="0.5"/>
    <ellipse cx="50" cy="42" rx="26" ry="20" fill="#B0BEC5"/>
    <ellipse cx="34" cy="44" rx="16" ry="14" fill="#B0BEC5"/>
    <ellipse cx="66" cy="44" rx="16" ry="14" fill="#B0BEC5"/>
    <ellipse cx="50" cy="38" rx="22" ry="18" fill="#CFD8DC"/>
    <ellipse cx="40" cy="34" rx="14" ry="12" fill="#E0E5E8"/>
    <ellipse cx="58" cy="36" rx="13" ry="11" fill="#E0E5E8"/>
    <ellipse cx="42" cy="42" rx="3.5" ry="4" fill="#2D3436"/>
    <ellipse cx="58" cy="42" rx="3.5" ry="4" fill="#2D3436"/>
    <ellipse cx="42.8" cy="40.5" rx="1.5" ry="1.8" fill="white"/>
    <ellipse cx="58.8" cy="40.5" rx="1.5" ry="1.8" fill="white"/>
    <path d="M37 34 L44 36.5" stroke="#455A64" stroke-width="2.5" stroke-linecap="round"/>
    <path d="M63 34 L56 36.5" stroke="#455A64" stroke-width="2.5" stroke-linecap="round"/>
    <path d="M44 49 Q50 54, 56 49" stroke="#2D3436" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <polygon points="44,58 48,58 46,66 52,66 40,82 44,70 38,70" fill="#FFD54F"/>
    <polygon points="56,60 59,60 57.5,66 62,66 54,76 56.5,68 53,68" fill="#FFD54F" opacity="0.7"/>
  </symbol>

  <symbol id="char-ollie" viewBox="0 0 64 64">
    <ellipse cx="32" cy="42" rx="18" ry="20" fill="#8B6914"/>
    <ellipse cx="32" cy="40" rx="15" ry="17" fill="#A67C28"/>
    <ellipse cx="32" cy="46" rx="10" ry="12" fill="#D4AA3A" opacity="0.5"/>
    <ellipse cx="14" cy="40" rx="8" ry="12" fill="#8B6914" transform="rotate(-10 14 40)"/>
    <ellipse cx="50" cy="40" rx="8" ry="12" fill="#8B6914" transform="rotate(10 50 40)"/>
    <circle cx="24" cy="30" r="9" fill="white"/>
    <circle cx="40" cy="30" r="9" fill="white"/>
    <circle cx="24" cy="30" r="5.5" fill="#3D2E1E"/>
    <circle cx="40" cy="30" r="5.5" fill="#3D2E1E"/>
    <circle cx="25.5" cy="28" r="2" fill="white"/>
    <circle cx="41.5" cy="28" r="2" fill="white"/>
    <circle cx="24" cy="30" r="10" fill="none" stroke="#5D4037" stroke-width="1.5"/>
    <circle cx="40" cy="30" r="10" fill="none" stroke="#5D4037" stroke-width="1.5"/>
    <line x1="34" y1="30" x2="30" y2="30" stroke="#5D4037" stroke-width="1.5"/>
    <line x1="14" y1="28" x2="10" y2="26" stroke="#5D4037" stroke-width="1.5"/>
    <line x1="50" y1="28" x2="54" y2="26" stroke="#5D4037" stroke-width="1.5"/>
    <path d="M29 36 L32 40 L35 36Z" fill="#FF8E53"/>
    <path d="M18 18 Q20 12, 24 20" fill="#8B6914"/>
    <path d="M46 18 Q44 12, 40 20" fill="#8B6914"/>
    <path d="M24 60 L20 63 M24 60 L24 63 M24 60 L28 63" stroke="#D4AA3A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    <path d="M40 60 L36 63 M40 60 L40 63 M40 60 L44 63" stroke="#D4AA3A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
  </symbol>

  <linearGradient id="flameGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#FF6B6B"/><stop offset="40%" stop-color="#FF8E53"/><stop offset="100%" stop-color="#FFB347"/>
  </linearGradient>
  <linearGradient id="bloomGrad" x1="0" y1="0" x2="0" y2="1">
    <stop offset="0%" stop-color="#66BB6A"/><stop offset="100%" stop-color="#81C784"/>
  </linearGradient>
</defs>
</svg>

<!-- ══════════════ PROGRESS DOTS ══════════════ -->
<div class="progress-dots" id="progressDots">
  <div class="dot active" id="dot0"></div>
  <div class="dot-line" id="line0"></div>
  <div class="dot locked" id="dot1"></div>
  <div class="dot-line" id="line1"></div>
  <div class="dot locked" id="dot2"></div>
</div>

<!-- ══════════════ MODE A: INTRO ══════════════ -->
<div class="screen intro-screen visible" id="introScreen">
  <div class="intro-content">
    <div class="intro-character" id="introChar">
      <svg><use href="#char-ignis"/></svg>
    </div>
    <div class="intro-trial-label" id="introLabel">Trial 1 of 3</div>
    <div class="intro-title" id="introTitle">The Story Spark</div>
    <div class="intro-mentor">
      <div class="intro-mentor-owl"><svg><use href="#char-ollie"/></svg></div>
      <div class="intro-mentor-text" id="introMentor">Every great quest begins with a story. Show me the spark of imagination inside you — write me a tale, and make it your own!</div>
    </div>
    <div class="intro-prompt">
      <div class="intro-prompt-label">Your Challenge</div>
      <div class="intro-prompt-text" id="introPrompt">Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?</div>
    </div>
    <button class="btn-start" id="btnStart" onclick="startWriting()">Start Writing!</button>
  </div>
</div>

<!-- ══════════════ MODE B: WRITING ══════════════ -->
<div class="screen write-screen hidden" id="writeScreen">
  <div class="write-content">
    <div class="write-prompt-bar">
      <div class="write-prompt-text" id="writePrompt">Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?</div>
    </div>
    <div class="write-area-wrap">
      <textarea class="write-textarea" id="writeArea" placeholder="Start writing your story here..." oninput="onType()"></textarea>
      <div class="spark-container" id="sparkContainer"></div>
      <div class="write-bottom">
        <div class="word-meter">
          <div class="meter-bar"><div class="meter-fill" id="meterFill"></div></div>
          <span class="meter-label" id="meterLabel">0 / 20 words</span>
        </div>
        <button class="btn-submit" id="btnSubmit" onclick="submitTrial()">I'm Done!</button>
      </div>
    </div>
  </div>
</div>

<!-- ══════════════ CELEBRATION ══════════════ -->
<div class="celebration" id="celebration">
  <div class="celeb-icon" id="celebIcon"><svg width="76" height="76"><use href="#char-ignis"/></svg></div>
  <div class="celeb-title" id="celebTitle">Trial Passed!</div>
  <div class="celeb-sub" id="celebSub">...</div>
  <div class="celeb-progress" id="celebProgress">1 of 3 complete</div>
</div>

<!-- ══════════════ FINALE ══════════════ -->
<div class="final-screen" id="finalScreen">
  <div class="final-owl"><svg><use href="#char-ollie"/></svg></div>
  <div class="final-title">You've proven yourself worthy!</div>
  <div class="final-sub">Welcome to the quest, <strong>Maya</strong>. Ollie is preparing your personal adventure path...</div>
  <div class="final-badges">
    <div class="final-badge"><div class="final-badge-icon" style="background:linear-gradient(145deg,#FFF3D4,#FFE4A8); border: 2px solid #FF6B6B40;"><svg><use href="#char-ignis"/></svg></div><div class="final-badge-name">Story Spark</div></div>
    <div class="final-badge"><div class="final-badge-icon" style="background:linear-gradient(145deg,#E8F5E9,#C8E6C9); border: 2px solid #4ECDC440;"><svg><use href="#char-bloom"/></svg></div><div class="final-badge-name">Sense Weaver</div></div>
    <div class="final-badge"><div class="final-badge-icon" style="background:linear-gradient(145deg,#ECEFF1,#CFD8DC); border: 2px solid #90A4AE40;"><svg><use href="#char-rumble"/></svg></div><div class="final-badge-name">Thunder Voice</div></div>
  </div>
  <div class="final-loading"><div class="final-spinner"></div><span class="final-loading-text">Crafting your curriculum...</span></div>
</div>

<script>
  let currentTrial = 0;
  const trials = [
    { label:'Trial 1 of 3', title:'The Story Spark', char:'#char-ignis', mentor:"Every great quest begins with a story. Show me the spark of imagination inside you — write me a tale, and make it your own!", prompt:"Write a short story about a kid who discovers something impossible hiding in an ordinary place. What is it? What happens next?", celebTitle:'Story Spark — Proven!', celebSub:"I can feel the storytelling magic in you! A new adventure awaits...", progress:'1 of 3 complete' },
    { label:'Trial 2 of 3', title:'The Sense Weaver', char:'#char-bloom', mentor:"A true writer doesn't just tell — they make readers SEE, HEAR, and FEEL. Show me you can weave the senses into your words!", prompt:"Describe your favorite place in the world so vividly that someone who's never been there can close their eyes and feel like they're standing right in it.", celebTitle:'Sense Weaver — Proven!', celebSub:"Brilliant! One final challenge remains — the hardest one...", progress:'2 of 3 complete' },
    { label:'Final Trial', title:'The Voice of Thunder', char:'#char-rumble', mentor:"The mightiest power a writer has is the power to change minds. Show me your voice of thunder — convince me!", prompt:"Should kids have a say in what they learn at school? Pick a side and write your strongest argument to convince your principal.", celebTitle:'All Trials Complete!', celebSub:"You've done it, Maya! You are worthy.", progress:'3 of 3 — Quest complete!' },
  ];

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => { s.classList.remove('visible'); s.classList.add('hidden'); });
    const el = document.getElementById(id);
    // Force reflow for re-entrance animations
    el.style.display = 'none'; el.offsetHeight; el.style.display = '';
    el.classList.remove('hidden'); el.classList.add('visible');
  }

  function updateDots() {
    for (let i = 0; i < 3; i++) {
      const dot = document.getElementById('dot'+i);
      dot.className = 'dot ' + (i < currentTrial ? 'done' : i === currentTrial ? 'active' : 'locked');
      if (i < currentTrial) dot.innerHTML = '<div class="dot-check">✓</div>'; else dot.innerHTML = '';
    }
    for (let i = 0; i < 2; i++) {
      const line = document.getElementById('line'+i);
      line.className = 'dot-line' + (i < currentTrial ? ' filled' : '');
    }
  }

  function loadTrial(idx) {
    const t = trials[idx];
    document.getElementById('introChar').innerHTML = '<svg><use href="'+t.char+'"/></svg>';
    document.getElementById('introLabel').textContent = t.label;
    document.getElementById('introTitle').textContent = t.title;
    document.getElementById('introMentor').textContent = t.mentor;
    document.getElementById('introPrompt').textContent = t.prompt;
    document.getElementById('writePrompt').textContent = t.prompt;
    document.getElementById('writeArea').value = '';
    document.getElementById('meterFill').style.width = '0%';
    document.getElementById('meterFill').classList.remove('full');
    document.getElementById('meterLabel').textContent = '0 / 20 words';
    document.getElementById('meterLabel').classList.remove('ready');
    document.getElementById('btnSubmit').classList.remove('ready');
    document.getElementById('btnSubmit').textContent = "I'm Done!";
    updateDots();
  }

  function startWriting() {
    showScreen('writeScreen');
    document.getElementById('writeArea').focus();
  }

  let lastTypedAt = 0;
  function onType() {
    const val = document.getElementById('writeArea').value;
    const words = val.trim().split(/\s+/).filter(Boolean).length;
    const pct = Math.min(words/20, 1);
    const fill = document.getElementById('meterFill');
    const label = document.getElementById('meterLabel');
    const btn = document.getElementById('btnSubmit');
    fill.style.width = (pct*100)+'%';
    if (pct >= 1) {
      fill.classList.add('full'); label.classList.add('ready');
      label.textContent = words + ' words ✓';
      btn.classList.add('ready');
      if (currentTrial === 2) btn.textContent = 'Complete the Quest!';
    } else {
      fill.classList.remove('full'); label.classList.remove('ready');
      label.textContent = words + ' / 20 words';
      btn.classList.remove('ready');
      btn.textContent = "I'm Done!";
    }
    // Spark particles
    const now = Date.now();
    if (now - lastTypedAt > 80) { lastTypedAt = now; spawnSpark(); }
  }

  function spawnSpark() {
    const c = document.getElementById('sparkContainer');
    const ta = document.getElementById('writeArea');
    for (let i = 0; i < 2; i++) {
      const s = document.createElement('div'); s.className = 'spark';
      s.style.left = (40+Math.random()*(ta.offsetWidth-80))+'px';
      s.style.top = (20+Math.random()*40)+'px';
      s.style.setProperty('--sx', ((Math.random()-0.5)*40)+'px');
      s.style.setProperty('--sy', (-(10+Math.random()*30))+'px');
      s.style.background = ['#FF6B6B','#4ECDC4','#FFE66D','#FF6B6B'][Math.floor(Math.random()*4)];
      const sz = 3+Math.random()*4;
      s.style.width = sz+'px'; s.style.height = sz+'px';
      c.appendChild(s);
      setTimeout(()=>s.remove(), 800);
    }
  }

  function submitTrial() {
    if (!document.getElementById('btnSubmit').classList.contains('ready')) return;
    const t = trials[currentTrial];

    // Show celebration
    const cel = document.getElementById('celebration');
    document.getElementById('celebIcon').innerHTML = '<svg width="76" height="76"><use href="'+t.char+'"/></svg>';
    document.getElementById('celebTitle').textContent = t.celebTitle;
    document.getElementById('celebSub').textContent = t.celebSub;
    document.getElementById('celebProgress').textContent = t.progress;
    cel.classList.add('show');
    spawnConfetti(cel);

    if (currentTrial < 2) {
      setTimeout(() => {
        cel.classList.remove('show');
        currentTrial++;
        loadTrial(currentTrial);
        showScreen('introScreen');
      }, 2800);
    } else {
      setTimeout(() => {
        cel.classList.remove('show');
        setTimeout(() => {
          // Hide all regular screens
          document.querySelectorAll('.screen').forEach(s => { s.classList.remove('visible'); s.classList.add('hidden'); });
          document.getElementById('progressDots').style.display = 'none';
          document.getElementById('finalScreen').classList.add('show');
          spawnConfetti(document.getElementById('finalScreen'));
        }, 300);
      }, 3200);
    }
  }

  function spawnConfetti(container) {
    const colors = ['#FF6B6B','#4ECDC4','#FFE66D','#FF8E53','#6C5CE7','#E17055','#A29BFE'];
    for (let i = 0; i < 50; i++) {
      const c = document.createElement('div'); c.className = 'confetti';
      const s = Math.random()*10+4;
      c.style.width = s+'px'; c.style.height = (s*(Math.random()*0.5+0.5))+'px';
      c.style.borderRadius = Math.random()>0.4?'50%':Math.random()>0.5?'2px':'0';
      c.style.background = colors[i%colors.length];
      c.style.left = (20+Math.random()*60)+'%'; c.style.top = (15+Math.random()*20)+'%';
      c.style.setProperty('--fd',(250+Math.random()*400)+'px');
      c.style.setProperty('--rot',((Math.random()-0.5)*1440)+'deg');
      c.style.transform = 'translateX('+((Math.random()-0.5)*500)+'px)';
      c.style.animationDuration = (1.2+Math.random()*1.5)+'s';
      c.style.animationDelay = (Math.random()*0.5)+'s';
      container.appendChild(c);
      setTimeout(()=>c.remove(), 3500);
    }
  }

  // Init
  loadTrial(0);
</script>
</body>
</html>
